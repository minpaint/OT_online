{% extends "admin/change_list.html" %}
{% load static i18n %}

{% block extrahead %}
  {{ block.super }}
  <link rel="stylesheet" href="{% static 'admin/css/tree_view.css' %}">
  <script src="{% static 'admin/js/tree_view.js' %}"></script>
{% endblock %}

{% block content %}
<div id="content-main">
  <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å –æ —Ä–∞–∑–¥–µ–ª–µ -->
  <div class="info-panel">
    <h2>üìë –≠—Ç–∞–ª–æ–Ω–Ω—ã–µ –Ω–æ—Ä–º—ã –º–µ–¥–æ—Å–º–æ—Ç—Ä–æ–≤</h2>
    <p>
      –≠—Ç–∞–ª–æ–Ω–Ω—ã–µ –Ω–æ—Ä–º—ã —Å–æ–¥–µ—Ä–∂–∞—Ç –æ–±—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞ –º–µ–¥–æ—Å–º–æ—Ç—Ä–æ–≤ –¥–ª—è –ø—Ä–æ—Ñ–µ—Å—Å–∏–π –±–µ–∑ –ø—Ä–∏–≤—è–∑–∫–∏ –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º.
      –î–ª—è –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –¥–æ–ª–∂–Ω–æ—Å—Ç–µ–π –≤–æ–∑–º–æ–∂–Ω–æ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π –≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ –¥–æ–ª–∂–Ω–æ—Å—Ç–µ–π.
    </p>
  </div>

  <form id="changelist-form" method="post" novalidate>
    {% csrf_token %}

    <div class="object-tools">
      <a href="{% url 'admin:directory_medicalexaminationnorm_add_multiple' %}" class="addlink">
        ‚ûï –î–æ–±–∞–≤–∏—Ç—å –≤—Ä–µ–¥–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã –¥–ª—è –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏
      </a>
    </div>

    <div class="tree-controls">
      <button type="button" class="tree-btn expand-all">‚Üì –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –≤—Å–µ</button>
      <button type="button" class="tree-btn collapse-all">‚Üë –°–≤–µ—Ä–Ω—É—Ç—å –≤—Å–µ</button>
      <div class="tree-search-container">
        <input type="text" class="tree-search" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –¥–æ–ª–∂–Ω–æ—Å—Ç—è–º‚Ä¶">
      </div>
    </div>

    <div class="results">
      <table id="result_list" class="tree-table">
        <thead>
          <tr>
            <th>–ü—Ä–æ—Ñ–µ—Å—Å–∏—è (–¥–æ–ª–∂–Ω–æ—Å—Ç—å)</th>
            <th>–ù–æ—Ä–º</th>
            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
          </tr>
        </thead>
        <tbody>
        {% for prof in professions %}
          {# –°—Ç—Ä–æ–∫–∞ —Å –∏–º–µ–Ω–µ–º –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏ #}
          <tr class="tree-row {% if prof.has_overrides %}has-overrides{% endif %}" data-level="0" data-node-id="prof_{{ forloop.counter }}">
            <td>
              <a href="{% url 'admin:directory_medicalexaminationnorm_add' %}?position={{ prof.reference_position.id }}">
                <strong>{{ prof.name }}</strong>
              </a>
              {% if prof.has_overrides %}
              <span class="override-indicator" title="–ò–º–µ—é—Ç—Å—è –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –¥–æ–ª–∂–Ω–æ—Å—Ç–µ–π">‚ö†Ô∏è</span>
              {% endif %}
            </td>
            <td>{{ prof.norms|length }}</td>
            <td>
              {# –£–±–∏—Ä–∞–µ–º –º–∞–ª–µ–Ω—å–∫–∏–π ¬´+¬ª #}
            </td>
          </tr>
          {# –í–ª–æ–∂–µ–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –Ω–æ—Ä–º–∞–º–∏ #}
          <tr class="tree-row" data-level="1" data-parent-id="prof_{{ forloop.counter }}">
            <td colspan="3" style="padding:0">
              <table class="table table-bordered table-striped" style="width:100%">
                <thead>
                  <tr>
                    <th>–§–∞–∫—Ç–æ—Ä</th>
                    <th>–ü–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å (–º–µ—Å.)</th>
                    <th>–ü—Ä–∏–º–µ—á–∞–Ω–∏—è</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                  </tr>
                </thead>
                <tbody>
                  {% for norm in prof.norms %}
                    <tr>
                      <td>{{ norm.harmful_factor.short_name }}</td>
                      <td>{{ norm.periodicity }}</td>
                      <td>{{ norm.notes|default:"‚Äî" }}</td>
                      <td>
                        <a href="{% url 'admin:directory_medicalexaminationnorm_change' norm.id %}" class="edit-link">‚úèÔ∏è</a>
                        <a href="{% url 'admin:directory_medicalexaminationnorm_delete' norm.id %}" class="delete-link">üóëÔ∏è</a>
                      </td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
  </form>
</div>
{% endblock %}