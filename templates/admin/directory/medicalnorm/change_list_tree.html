{% extends "admin/change_list.html" %}
{% load static i18n %}

{% block extrahead %}
  {{ block.super }}
  <link rel="stylesheet" href="{% static 'admin/css/tree_view.css' %}">
  <script src="{% static 'admin/js/tree_view.js' %}"></script>
{% endblock %}

{% block content %}
<div id="content-main">
  <form id="changelist-form" method="post" novalidate>
    {% csrf_token %}

    <div class="object-tools">
      <!-- –ë–æ–ª—å—à–æ–π –∑–µ–ª—ë–Ω—ã–π ¬´+¬ª -->
      <a href="{% url 'admin:directory_medicalexaminationnorm_add' %}" class="addlink">
        –î–æ–±–∞–≤–∏—Ç—å –Ω–æ—Ä–º—É –º–µ–¥–æ—Å–º–æ—Ç—Ä–∞
      </a>
    </div>

    <div class="tree-controls">
      <button type="button" class="tree-btn expand-all">‚Üì –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –≤—Å–µ</button>
      <button type="button" class="tree-btn collapse-all">‚Üë –°–≤–µ—Ä–Ω—É—Ç—å –≤—Å–µ</button>
      <div class="tree-search-container">
        <input type="text" class="tree-search" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –¥–æ–ª–∂–Ω–æ—Å—Ç—è–º‚Ä¶">
      </div>
    </div>

    <div class="results">
      <table id="result_list" class="tree-table">
        <thead>
          <tr>
            <th>–ü—Ä–æ—Ñ–µ—Å—Å–∏—è (–¥–æ–ª–∂–Ω–æ—Å—Ç—å)</th>
            <th>–ù–æ—Ä–º</th>
            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
          </tr>
        </thead>
        <tbody>
        {% for prof in professions %}
          {# –°—Ç—Ä–æ–∫–∞ —Å –∏–º–µ–Ω–µ–º –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏ #}
          <tr class="tree-row" data-level="0" data-node-id="prof_{{ forloop.counter }}">
            <td>
              {# –î–µ–ª–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã–º: –∫–ª–∏–∫ –≤–µ–¥—ë—Ç —Å—Ä–∞–∑—É –≤ —Ñ–æ—Ä–º—É –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å —Ç–µ–∫—É—â–µ–π –ø—Ä–æ—Ñ–µ—Å—Å–∏–µ–π #}
              <a href="{% url 'admin:directory_medicalexaminationnorm_add' %}?position={{ prof.reference_position.id }}">
                <strong>{{ prof.name }}</strong>
              </a>
            </td>
            <td>{{ prof.norms|length }}</td>
            <td>
              {# –£–±–∏—Ä–∞–µ–º –º–∞–ª–µ–Ω—å–∫–∏–π ¬´+¬ª ‚Äî –æ—Å—Ç–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –±–æ–ª—å—à–æ–π –≤ —à–∞–ø–∫–µ #}
            </td>
          </tr>
          {# –í–ª–æ–∂–µ–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –Ω–æ—Ä–º–∞–º–∏ #}
          <tr class="tree-row" data-level="1" data-parent-id="prof_{{ forloop.counter }}">
            <td colspan="3" style="padding:0">
              <table class="table table-bordered table-striped" style="width:100%">
                <thead>
                  <tr>
                    <th>–§–∞–∫—Ç–æ—Ä</th>
                    <th>–ü–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å (–º–µ—Å.)</th>
                    <th>–ü—Ä–∏–º–µ—á–∞–Ω–∏—è</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                  </tr>
                </thead>
                <tbody>
                  {% for norm in prof.norms %}
                    <tr>
                      <td>{{ norm.harmful_factor.short_name }}</td>
                      <td>{{ norm.periodicity }}</td>
                      <td>{{ norm.notes|default:"‚Äî" }}</td>
                      <td>
                        <a href="{% url 'admin:directory_medicalexaminationnorm_change' norm.id %}" class="edit-link">‚úèÔ∏è</a>
                        <a href="{% url 'admin:directory_medicalexaminationnorm_delete' norm.id %}" class="delete-link">üóëÔ∏è</a>
                      </td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
  </form>
</div>
{% endblock %}
