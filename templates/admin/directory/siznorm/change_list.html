{% extends "admin/change_list.html" %}

{% load static %}

{% block content %}
<div id="content-main">
 <div class="object-tools">
 <a href="{% url 'admin:directory_siznorm_add' %}" class="addlink">
 –î–æ–±–∞–≤–∏—Ç—å –Ω–æ—Ä–º—É –°–ò–ó
</a>
 <a href="{% url 'admin:directory_siz_add' %}" class="addlink">
 –î–æ–±–∞–≤–∏—Ç—å –°–ò–ó
</a>
 </div>

 <form id="changelist-form" method="post"
 {% if cl.formset and cl.formset.is_multipart %} enctype="multipart/form-data"{% endif %}
novalidate>
 {% csrf_token %}
{% if action_form and actions_on_top and cl.show_admin_actions %}
<div class="actions">
 {% for field in action_form %}
{% if field.label %}<label>{{ field.label }}</label>{% endif %}
{{ field }}
{% endfor %}
<button type="submit" class="button" title="–í—ã–ø–æ–ª–Ω–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ">–í—ã–ø–æ–ª–Ω–∏—Ç—å</button>
 <span class="action-counter" style="display: none;">0 –∏–∑ {{ cl.result_count }} –≤—ã–±—Ä–∞–Ω–æ</span>
 </div>
 {% endif %}

<div class="tree-controls">
 <button type="button" class="tree-btn expand-all">‚Üì –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –≤—Å–µ</button>
 <button type="button" class="tree-btn collapse-all">‚Üë –°–≤–µ—Ä–Ω—É—Ç—å –≤—Å–µ</button>
 <div class="tree-search-container">
 <input type="text" class="tree-search" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ —Å–ø–∏—Å–∫—É...">
 </div>
 </div>

 <div class="results">
 <table id="result_list">
 <thead>
 <tr>
 <th class="column-checkbox"><input type="checkbox" id="select-all"></th>
 <th class="column-name">–ü–†–û–§–ï–°–°–ò–Ø/–î–û–õ–ñ–ù–û–°–¢–¨</th>
 <th class="column-roles">–ö–û–õ–ò–ß–ï–°–¢–í–û –ù–û–†–ú –°–ò–ó</th>
 <th class="column-actions">–î–ï–ô–°–¢–í–ò–Ø</th>
 </tr>
 </thead>
 <tbody>
 {% for position_data in positions %}
<tr class="tree-row" data-level="0" data-node-id="position_{{ position_data.position.id }}">
 <td class="field-checkbox">
 <input type="checkbox" name="_selected_action" value="{{ position_data.position.id }}" class="action-select">
 </td>
 <td class="field-name">
 <button type="button" class="toggle-btn" data-state="expanded">[-]</button>
 <span class="tree-icon">üëî</span>
 <a href="{% url 'admin:directory_position_change' position_data.position.id %}">
 <strong>{{ position_data.position.position_name }}</strong>
 {% if position_data.position.organization %}
<small>({{ position_data.position.organization.short_name_ru }})</small>
 {% endif %}
</a>
 </td>
 <td class="field-roles">{{ position_data.position.siz_norms.count }} –Ω–æ—Ä–º –°–ò–ó</td>
 <td class="field-actions">
 <a href="{% url 'directory:position_siz_norms' position_data.position.id %}" class="view-link" title="–ü—Ä–æ—Å–º–æ—Ç—Ä –Ω–æ—Ä–º –°–ò–ó">üëÅÔ∏è</a>
 <a href="{% url 'admin:directory_position_change' position_data.position.id %}" class="edit-link" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–æ–ª–∂–Ω–æ—Å—Ç—å">‚úèÔ∏è</a>
 <a href="{% url 'admin:directory_siznorm_add' %}?position={{ position_data.position.id }}" class="add-link" title="–î–æ–±–∞–≤–∏—Ç—å –Ω–æ—Ä–º—É –°–ò–ó">+</a>
 </td>
 </tr>

 {% if position_data.base_norms %}
<!-- –£–î–ê–õ–Å–ù –∑–∞–≥–æ–ª–æ–≤–æ–∫ "–û—Å–Ω–æ–≤–Ω—ã–µ –Ω–æ—Ä–º—ã", –æ—Å—Ç–∞–≤–ª–µ–Ω—ã —Ç–æ–ª—å–∫–æ –Ω–æ—Ä–º—ã -->
 <tr class="tree-row" data-level="2" data-parent-id="position_{{ position_data.position.id }}">
 <td colspan="4" style="padding:0">
 <table class="table table-bordered table-striped" style="width:100%">
 <thead>
 <tr>
 <th>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –°–ò–ó</th>
 <th>–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è</th>
 <th>–ï–¥. –∏–∑–º.</th>
 <th>–ö–æ–ª-–≤–æ</th>
 <th>–°—Ä–æ–∫ –Ω–æ—Å–∫–∏</th>
 <th>–î–µ–π—Å—Ç–≤–∏—è</th>
 </tr>
 </thead>
 <tbody>
 {% for norm in position_data.base_norms %}
<tr>
 <td>{{ norm.siz.name }}</td>
 <td>{{ norm.siz.classification }}</td>
 <td>{{ norm.siz.unit }}</td>
 <td>{{ norm.quantity }}</td>
 <td>{% if norm.siz.wear_period == 0 %}–î–æ –∏–∑–Ω–æ—Å–∞{% else %}{{ norm.siz.wear_period }} –º–µ—Å.{% endif %}</td>
 <td>
 <a href="{% url 'admin:directory_siznorm_change' norm.id %}" class="edit-link">‚úèÔ∏è</a>
 <a href="{% url 'admin:directory_siznorm_delete' norm.id %}" class="delete-link">üóëÔ∏è</a>
 </td>
 </tr>
 {% endfor %}
</tbody>
 </table>
 </td>
 </tr>
 {% else %}
<tr class="tree-row" data-level="1" data-parent-id="position_{{ position_data.position.id }}">
 <td class="field-checkbox"></td>
 <td class="field-name">
 <span class="tree-icon">üìã</span>
 <strong>–ù–µ—Ç –Ω–æ—Ä–º –°–ò–ó</strong>
 </td>
 <td class="field-roles"></td>
 <td class="field-actions">
 <a href="{% url 'admin:directory_siznorm_add' %}?position={{ position_data.position.id }}" class="add-link">+</a>
 </td>
 </tr>
 {% endif %}

{% for group in position_data.group_norms %}
<tr class="tree-row" data-level="1" data-parent-id="position_{{ position_data.position.id }}">
 <td class="field-checkbox"></td>
 <td class="field-name">
 <span class="tree-icon">üîç</span>
 <strong>{{ group.name }}</strong>
 </td>
 <td class="field-roles">{{ group.norms|length }} –ø–æ–∑–∏—Ü–∏–π</td>
 <td class="field-actions"></td>
 </tr>

 <!-- –¢–∞–±–ª–∏—Ü–∞ —Å –Ω–æ—Ä–º–∞–º–∏ –°–ò–ó –ø–æ —É—Å–ª–æ–≤–∏—é -->
 <tr class="tree-row" data-level="2" data-parent-id="position_{{ position_data.position.id }}">
 <td colspan="4" style="padding:0">
 <table class="table table-bordered table-striped" style="width:100%">
 <thead>
 <tr>
 <th>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –°–ò–ó</th>
 <th>–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è</th>
 <th>–ï–¥. –∏–∑–º.</th>
 <th>–ö–æ–ª-–≤–æ</th>
 <th>–°—Ä–æ–∫ –Ω–æ—Å–∫–∏</th>
 <th>–î–µ–π—Å—Ç–≤–∏—è</th>
 </tr>
 </thead>
 <tbody>
 {% for norm in group.norms %}
<tr>
 <td>{{ norm.siz.name }}</td>
 <td>{{ norm.siz.classification }}</td>
 <td>{{ norm.siz.unit }}</td>
 <td>{{ norm.quantity }}</td>
 <td>{% if norm.siz.wear_period == 0 %}–î–æ –∏–∑–Ω–æ—Å–∞{% else %}{{ norm.siz.wear_period }} –º–µ—Å.{% endif %}</td>
 <td>
 <a href="{% url 'admin:directory_siznorm_change' norm.id %}" class="edit-link">‚úèÔ∏è</a>
 <a href="{% url 'admin:directory_siznorm_delete' norm.id %}" class="delete-link">üóëÔ∏è</a>
 </td>
 </tr>
 {% endfor %}
</tbody>
 </table>
 </td>
 </tr>
 {% endfor %}
{% endfor %}
</tbody>
 </table>
 </div>
 </form>
</div>

<script src="{% static 'admin/js/tree_view.js' %}"></script>
<script src="{% static 'admin/js/tree_search.js' %}"></script>
{% endblock %}