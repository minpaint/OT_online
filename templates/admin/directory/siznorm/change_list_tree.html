{% extends "admin/change_list.html" %}

{% load static %}

{% block content %}
<div id="content-main">
 <div class="object-tools">
 <a href="{% url 'admin:directory_siznorm_add' %}" class="addlink">
 –î–æ–±–∞–≤–∏—Ç—å –Ω–æ—Ä–º—É –°–ò–ó
</a>
 <a href="{% url 'admin:directory_siz_add' %}" class="addlink">
 –î–æ–±–∞–≤–∏—Ç—å –°–ò–ó
</a>
 </div>

 <form id="changelist-form" method="post"
 {% if cl.formset and cl.formset.is_multipart %} enctype="multipart/form-data"{% endif %}
novalidate>
 {% csrf_token %}
{% if action_form and actions_on_top and cl.show_admin_actions %}
<div class="actions">
 {% for field in action_form %}
{% if field.label %}<label>{{ field.label }}</label>{% endif %}
{{ field }}
{% endfor %}
<button type="submit" class="button" title="–í—ã–ø–æ–ª–Ω–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ">–í—ã–ø–æ–ª–Ω–∏—Ç—å</button>
 <span class="action-counter" style="display: none;">0 –∏–∑ {{ cl.result_count }} –≤—ã–±—Ä–∞–Ω–æ</span>
 </div>
 {% endif %}

<div class="tree-controls">
 <button type="button" class="tree-btn expand-all">‚Üì –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –≤—Å–µ</button>
 <button type="button" class="tree-btn collapse-all">‚Üë –°–≤–µ—Ä–Ω—É—Ç—å –≤—Å–µ</button>
 <div class="tree-search-container">
 <input type="text" class="tree-search" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ —Å–ø–∏—Å–∫—É...">
 </div>
 </div>

 <div class="results">
 <table id="result_list">
 <thead>
 <tr>
 <th class="column-checkbox"><input type="checkbox" id="select-all"></th>
 <th class="column-name">–ü–†–û–§–ï–°–°–ò–Ø/–î–û–õ–ñ–ù–û–°–¢–¨</th>
 <th class="column-roles">–ù–û–†–ú–´ –°–ò–ó / –≠–ö–ó–ï–ú–ü–õ–Ø–†–´</th>
 <th class="column-actions">–î–ï–ô–°–¢–í–ò–Ø</th>
 </tr>
 </thead>
 <tbody>
 {% for profession in professions %}
<tr class="tree-row" data-level="0" data-node-id="profession_{{ forloop.counter }}">
 <td class="field-checkbox"></td>
 <td class="field-name">
 <button type="button" class="toggle-btn" data-state="expanded">[-]</button>
 <span class="tree-icon">üëî</span>
 <strong>{{ profession.name }}</strong>
 </td>
 <td class="field-roles">{{ profession.positions|length }} —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤</td>
 <td class="field-actions">
 <!-- –î–µ–π—Å—Ç–≤–∏—è –¥–ª—è –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏ -->
 </td>
 </tr>

 <!-- –°–ø–∏—Å–æ–∫ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ —ç—Ç–æ–π –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏ –≤ —Ä–∞–∑–Ω—ã—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è—Ö -->
 <tr class="tree-row" data-level="1" data-parent-id="profession_{{ forloop.counter }}">
 <td class="field-checkbox"></td>
 <td class="field-name">
 <span class="tree-icon">üìÇ</span>
 <strong>–≠–∫–∑–µ–º–ø–ª—è—Ä—ã –¥–æ–ª–∂–Ω–æ—Å—Ç–∏ ({{ profession.positions|length }})</strong>
 </td>
 <td class="field-roles"></td>
 <td class="field-actions"></td>
 </tr>

 {% for position in profession.positions %}
<tr class="tree-row" data-level="2" data-parent-id="profession_{{ forloop.counter }}">
 <td class="field-checkbox">
 <input type="checkbox" name="_selected_action" value="{{ position.id }}" class="action-select">
 </td>
 <td class="field-name">
 <span class="tree-icon">üìù</span>
 <a href="{% url 'admin:directory_position_change' position.id %}">
 {{ position.organization.short_name_ru }}
{% if position.department %}
- {{ position.department.name }}
{% elif position.subdivision %}
- {{ position.subdivision.name }}
{% endif %}
</a>
 </td>
 <td class="field-roles">{{ position.siz_norms.count }} –Ω–æ—Ä–º</td>
 <td class="field-actions">
 <a href="{% url 'admin:directory_position_change' position.id %}" class="edit-link" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–æ–ª–∂–Ω–æ—Å—Ç—å">‚úèÔ∏è</a>
 <a href="{% url 'admin:directory_siznorm_add' %}?position={{ position.id }}" class="add-link" title="–î–æ–±–∞–≤–∏—Ç—å –Ω–æ—Ä–º—É –°–ò–ó">+</a>
 </td>
 </tr>
 {% endfor %}

<!-- –ë–∞–∑–æ–≤—ã–µ –Ω–æ—Ä–º—ã –°–ò–ó –¥–ª—è –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏ - –£–î–ê–õ–Å–ù –ó–ê–ì–û–õ–û–í–û–ö "–û—Å–Ω–æ–≤–Ω—ã–µ –Ω–æ—Ä–º—ã" -->
 {% if profession.base_norms %}
<tr class="tree-row" data-level="1" data-parent-id="profession_{{ forloop.counter }}">
 <td colspan="4" style="padding:0">
 <table class="table table-bordered table-striped" style="width:100%">
 <thead>
 <tr>
 <th>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –°–ò–ó</th>
 <th>–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è</th>
 <th>–ï–¥. –∏–∑–º.</th>
 <th>–ö–æ–ª-–≤–æ</th>
 <th>–°—Ä–æ–∫ –Ω–æ—Å–∫–∏</th>
 <th>–î–µ–π—Å—Ç–≤–∏—è</th>
 </tr>
 </thead>
 <tbody>
 {% for norm in profession.base_norms %}
<tr>
 <td>{{ norm.siz.name }}</td>
 <td>{{ norm.siz.classification }}</td>
 <td>{{ norm.siz.unit }}</td>
 <td>{{ norm.quantity }}</td>
 <td>{% if norm.siz.wear_period == 0 %}–î–æ –∏–∑–Ω–æ—Å–∞{% else %}{{ norm.siz.wear_period }} –º–µ—Å.{% endif %}</td>
 <td>
 <a href="{% url 'admin:directory_siznorm_change' norm.id %}" class="edit-link">‚úèÔ∏è</a>
 <a href="{% url 'admin:directory_siznorm_delete' norm.id %}" class="delete-link">üóëÔ∏è</a>
 </td>
 </tr>
 {% endfor %}
</tbody>
 </table>
 </td>
 </tr>
 {% endif %}

<!-- –ù–æ—Ä–º—ã –°–ò–ó –ø–æ —É—Å–ª–æ–≤–∏—è–º - –æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å -->
 {% for group in profession.group_norms %}
<tr class="tree-row" data-level="1" data-parent-id="profession_{{ forloop.counter }}">
 <td class="field-checkbox"></td>
 <td class="field-name">
 <span class="tree-icon">üîç</span>
 <strong>{{ group.name }}</strong>
 </td>
 <td class="field-roles">{{ group.norms|length }} –ø–æ–∑–∏—Ü–∏–π</td>
 <td class="field-actions"></td>
 </tr>

 <tr class="tree-row" data-level="2" data-parent-id="profession_{{ forloop.counter }}">
 <td colspan="4" style="padding:0">
 <table class="table table-bordered table-striped" style="width:100%">
 <thead>
 <tr>
 <th>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –°–ò–ó</th>
 <th>–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è</th>
 <th>–ï–¥. –∏–∑–º.</th>
 <th>–ö–æ–ª-–≤–æ</th>
 <th>–°—Ä–æ–∫ –Ω–æ—Å–∫–∏</th>
 <th>–î–µ–π—Å—Ç–≤–∏—è</th>
 </tr>
 </thead>
 <tbody>
 {% for norm in group.norms %}
<tr>
 <td>{{ norm.siz.name }}</td>
 <td>{{ norm.siz.classification }}</td>
 <td>{{ norm.siz.unit }}</td>
 <td>{{ norm.quantity }}</td>
 <td>{% if norm.siz.wear_period == 0 %}–î–æ –∏–∑–Ω–æ—Å–∞{% else %}{{ norm.siz.wear_period }} –º–µ—Å.{% endif %}</td>
 <td>
 <a href="{% url 'admin:directory_siznorm_change' norm.id %}" class="edit-link">‚úèÔ∏è</a>
 <a href="{% url 'admin:directory_siznorm_delete' norm.id %}" class="delete-link">üóëÔ∏è</a>
 </td>
 </tr>
 {% endfor %}
</tbody>
 </table>
 </td>
 </tr>
 {% endfor %}
{% endfor %}
</tbody>
 </table>
 </div>
 </form>
</div>

<script src="{% static 'admin/js/tree_view.js' %}"></script>
<script src="{% static 'admin/js/tree_search.js' %}"></script>
{% endblock %}