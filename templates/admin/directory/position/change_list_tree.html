{% extends "admin/change_list.html" %}
{% load static %}

{% block content %}

<div id="content-main">
 <div class="object-tools">
 <a href="{% url 'admin:directory_position_add' %}" class="addlink">
 Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ
</a>
 </div>
 <form id="changelist-form" method="post"
 {% if cl.formset and cl.formset.is_multipart %} enctype="multipart/form-data"{% endif %}
novalidate>
 {% csrf_token %}
{% if action_form and actions_on_top and cl.show_admin_actions %}
<div class="actions">
 {% for field in action_form %}
{% if field.label %}<label>{{ field.label }}</label>{% endif %}
{{ field }}
{% endfor %}
<button type="submit" class="button" title="Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ÑŒ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ">Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ÑŒ</button>
 <span class="action-counter" style="display: none;">0 Ğ¸Ğ· {{ cl.result_count }} Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ¾</span>
 </div>
 {% endif %}

<div class="tree-controls">
 <button type="button" class="tree-btn expand-all">â†“ Ğ Ğ°Ğ·Ğ²ĞµÑ€Ğ½ÑƒÑ‚ÑŒ Ğ²ÑĞµ</button>
 <button type="button" class="tree-btn collapse-all">â†‘ Ğ¡Ğ²ĞµÑ€Ğ½ÑƒÑ‚ÑŒ Ğ²ÑĞµ</button>
 <div class="tree-search-container">
 <input type="text" class="tree-search" placeholder="ğŸ” ĞŸĞ¾Ğ¸ÑĞº Ğ¿Ğ¾ Ğ´ĞµÑ€ĞµĞ²Ñƒ...">
 </div>
 </div>

 <div class="results">
 <table id="result_list">
 <thead>
 <tr>
 <th class="column-checkbox"><input type="checkbox" id="select-all"></th>
 <th class="column-name">ĞĞĞ˜ĞœĞ•ĞĞĞ’ĞĞĞ˜Ğ•</th>
 <th class="column-roles">ĞĞ¢Ğ Ğ˜Ğ‘Ğ£Ğ¢Ğ«/Ğ ĞĞ›Ğ˜</th>
 <th class="column-actions">Ğ”Ğ•Ğ™Ğ¡Ğ¢Ğ’Ğ˜Ğ¯</th>
 </tr>
 </thead>
 <tbody>
 {% for org, org_data in tree.items %}
<tr class="tree-row" data-level="0" data-node-id="org_{{ org.id }}">
 <td class="field-checkbox"></td>
 <td class="field-name">
 <button type="button" class="toggle-btn" data-state="expanded">[-]</button>
 <span class="tree-icon">{{ tree_settings.icons.organization|default:"ğŸ¢" }}</span>
 <strong>{{ org_data.name }}</strong>
 </td>
 <td class="field-roles"></td>
 <td class="field-actions"></td>
 </tr>

 {# Ğ­Ğ»ĞµĞ¼ĞµĞ½Ñ‚Ñ‹ Ğ±ĞµĞ· subdivision #}
 {% for item in org_data.items %}
<tr class="tree-row" data-level="1" data-parent-id="org_{{ org.id }}">
 <td class="field-checkbox">
 <input type="checkbox" name="_selected_action" value="{{ item.object.pk }}" class="action-select">
 </td>
 <td class="field-name">
 <span class="tree-icon">{{ item.additional_data.profession_icon|default:"ğŸ‘”" }}</span>
 <a href="{% url 'admin:directory_position_change' item.object.pk %}">
 {{ item.name }}
</a>
 </td>
 <td class="field-roles">
 {% if item.additional_data.total_siz_norms > 0 %}
<span class="badge badge-success" title="Ğ˜Ğ¼ĞµÑÑ‚ÑÑ Ğ½Ğ¾Ñ€Ğ¼Ñ‹ Ğ¡Ğ˜Ğ—">ğŸ›¡ï¸ {{ item.additional_data.total_siz_norms }}</span>
 {% endif %}

{% if item.additional_data.medical_factors_count > 0 %}
<span class="badge badge-info" title="Ğ˜Ğ¼ĞµÑÑ‚ÑÑ Ñ„Ğ°ĞºÑ‚Ğ¾Ñ€Ñ‹ Ğ¼ĞµĞ´Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ¾Ğ²">ğŸ¥ {{ item.additional_data.medical_factors_count }}</span>
 {% endif %}

{% if item.additional_data.is_responsible_for_safety %}
<span class="position-attribute" title="ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ·Ğ° ĞĞ¢">ğŸ”°</span>
 {% endif %}

{% if item.additional_data.can_be_internship_leader %}
<span class="position-attribute" title="ĞœĞ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ñ€ÑƒĞºĞ¾Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ĞµĞ¼ ÑÑ‚Ğ°Ğ¶Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¸">ğŸ‘¨â€ğŸ«</span>
 {% endif %}

{% if item.additional_data.is_electrical_personnel %}
<span class="position-attribute" title="Ğ­Ğ»ĞµĞºÑ‚Ñ€Ğ¾Ñ‚ĞµÑ…Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ»">âš¡</span>
 {% endif %}

{# ĞœĞ¾Ğ¶ĞµÑ‚ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°Ñ‚ÑŒ Ñ€Ğ°ÑĞ¿Ğ¾Ñ€ÑĞ¶ĞµĞ½Ğ¸Ñ #}
{% if item.additional_data.can_sign_orders %}
<span class="position-attribute" title="ĞœĞ¾Ğ¶ĞµÑ‚ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°Ñ‚ÑŒ Ñ€Ğ°ÑĞ¿Ğ¾Ñ€ÑĞ¶ĞµĞ½Ğ¸Ñ">ğŸ“</span>
{% endif %}

{# Ğ“Ñ€ÑƒĞ¿Ğ¿Ğ° Ğ¿Ğ¾ ÑĞ»ĞµĞºÑ‚Ñ€Ğ¾Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸ #}
{% with g=item.additional_data.electrical_group %}
{% if g %}
<span class="position-attribute" title="Ğ“Ñ€ÑƒĞ¿Ğ¿Ğ° {{ g }} Ğ¿Ğ¾ Ğ­Ğ‘">
    {% if g == "I" %}1ï¸âƒ£{% elif g == "II" %}2ï¸âƒ£
    {% elif g == "III" %}3ï¸âƒ£{% elif g == "IV" %}4ï¸âƒ£
    {% elif g == "V" %}5ï¸âƒ£{% endif %}
</span>
{% endif %}
{% endwith %}

{# Ğ Ğ¾Ğ»ÑŒ Ğ² ĞºĞ¾Ğ¼Ğ¸ÑÑĞ¸Ğ¸ #}
{% with r=item.additional_data.commission_role %}
{% if r == "chair" %}
<span class="position-attribute" title="ĞŸÑ€ĞµĞ´ÑĞµĞ´Ğ°Ñ‚ĞµĞ»ÑŒ ĞºĞ¾Ğ¼Ğ¸ÑÑĞ¸Ğ¸">ğŸ—³ï¸</span>
{% elif r == "member" %}
<span class="position-attribute" title="Ğ§Ğ»ĞµĞ½ ĞºĞ¾Ğ¼Ğ¸ÑÑĞ¸Ğ¸">ğŸ‘¥</span>
{% elif r == "secretary" %}
<span class="position-attribute" title="Ğ¡ĞµĞºÑ€ĞµÑ‚Ğ°Ñ€ÑŒ ĞºĞ¾Ğ¼Ğ¸ÑÑĞ¸Ğ¸">ğŸ“</span>
{% endif %}
{% endwith %}
</td>
 <td class="field-actions">
 <a href="{% url 'admin:directory_position_change' item.object.pk %}" class="edit-link">âœï¸</a>
 <a href="{% url 'admin:directory_position_delete' item.object.pk %}" class="delete-link">ğŸ—‘ï¸</a>
 <a href="{% url 'admin:directory_position_history' item.object.pk %}" class="history-link">ğŸ“‹</a>
 </td>
 </tr>
 {% endfor %}

{# ĞŸĞ¾Ğ´Ñ€Ğ°Ğ·Ğ´ĞµĞ»ĞµĞ½Ğ¸Ñ #}
 {% for sub, sub_data in org_data.subdivisions.items %}
<tr class="tree-row" data-level="1" data-parent-id="org_{{ org.id }}" data-node-id="sub_{{ sub.id }}">
 <td class="field-checkbox"></td>
 <td class="field-name">
 <button type="button" class="toggle-btn" data-state="expanded">[-]</button>
 <span class="tree-icon">{{ tree_settings.icons.subdivision|default:"ğŸ­" }}</span>
 {{ sub_data.name }}
</td>
 <td class="field-roles"></td>
 <td class="field-actions"></td>
 </tr>

 {# Ğ­Ğ»ĞµĞ¼ĞµĞ½Ñ‚Ñ‹ Ğ±ĞµĞ· department #}
 {% for item in sub_data.items %}
<tr class="tree-row" data-level="2" data-parent-id="sub_{{ sub.id }}">
 <td class="field-checkbox">
 <input type="checkbox" name="_selected_action" value="{{ item.object.pk }}" class="action-select">
 </td>
 <td class="field-name">
 <span class="tree-icon">{{ item.additional_data.profession_icon|default:"ğŸ‘”" }}</span>
 <a href="{% url 'admin:directory_position_change' item.object.pk %}">
 {{ item.name }}
</a>
 </td>
 <td class="field-roles">
 {% if item.additional_data.total_siz_norms > 0 %}
<span class="badge badge-success" title="Ğ˜Ğ¼ĞµÑÑ‚ÑÑ Ğ½Ğ¾Ñ€Ğ¼Ñ‹ Ğ¡Ğ˜Ğ—">ğŸ›¡ï¸ {{ item.additional_data.total_siz_norms }}</span>
 {% endif %}

{% if item.additional_data.medical_factors_count > 0 %}
<span class="badge badge-info" title="Ğ˜Ğ¼ĞµÑÑ‚ÑÑ Ñ„Ğ°ĞºÑ‚Ğ¾Ñ€Ñ‹ Ğ¼ĞµĞ´Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ¾Ğ²">ğŸ¥ {{ item.additional_data.medical_factors_count }}</span>
 {% endif %}

{% if item.additional_data.is_responsible_for_safety %}
<span class="position-attribute" title="ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ·Ğ° ĞĞ¢">ğŸ”°</span>
 {% endif %}

{% if item.additional_data.can_be_internship_leader %}
<span class="position-attribute" title="ĞœĞ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ñ€ÑƒĞºĞ¾Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ĞµĞ¼ ÑÑ‚Ğ°Ğ¶Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¸">ğŸ‘¨â€ğŸ«</span>
 {% endif %}

{% if item.additional_data.is_electrical_personnel %}
<span class="position-attribute" title="Ğ­Ğ»ĞµĞºÑ‚Ñ€Ğ¾Ñ‚ĞµÑ…Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ»">âš¡</span>
 {% endif %}

{# ĞœĞ¾Ğ¶ĞµÑ‚ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°Ñ‚ÑŒ Ñ€Ğ°ÑĞ¿Ğ¾Ñ€ÑĞ¶ĞµĞ½Ğ¸Ñ #}
{% if item.additional_data.can_sign_orders %}
<span class="position-attribute" title="ĞœĞ¾Ğ¶ĞµÑ‚ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°Ñ‚ÑŒ Ñ€Ğ°ÑĞ¿Ğ¾Ñ€ÑĞ¶ĞµĞ½Ğ¸Ñ">ğŸ“</span>
{% endif %}

{# Ğ“Ñ€ÑƒĞ¿Ğ¿Ğ° Ğ¿Ğ¾ ÑĞ»ĞµĞºÑ‚Ñ€Ğ¾Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸ #}
{% with g=item.additional_data.electrical_group %}
{% if g %}
<span class="position-attribute" title="Ğ“Ñ€ÑƒĞ¿Ğ¿Ğ° {{ g }} Ğ¿Ğ¾ Ğ­Ğ‘">
    {% if g == "I" %}1ï¸âƒ£{% elif g == "II" %}2ï¸âƒ£
    {% elif g == "III" %}3ï¸âƒ£{% elif g == "IV" %}4ï¸âƒ£
    {% elif g == "V" %}5ï¸âƒ£{% endif %}
</span>
{% endif %}
{% endwith %}

{# Ğ Ğ¾Ğ»ÑŒ Ğ² ĞºĞ¾Ğ¼Ğ¸ÑÑĞ¸Ğ¸ #}
{% with r=item.additional_data.commission_role %}
{% if r == "chair" %}
<span class="position-attribute" title="ĞŸÑ€ĞµĞ´ÑĞµĞ´Ğ°Ñ‚ĞµĞ»ÑŒ ĞºĞ¾Ğ¼Ğ¸ÑÑĞ¸Ğ¸">ğŸ—³ï¸</span>
{% elif r == "member" %}
<span class="position-attribute" title="Ğ§Ğ»ĞµĞ½ ĞºĞ¾Ğ¼Ğ¸ÑÑĞ¸Ğ¸">ğŸ‘¥</span>
{% elif r == "secretary" %}
<span class="position-attribute" title="Ğ¡ĞµĞºÑ€ĞµÑ‚Ğ°Ñ€ÑŒ ĞºĞ¾Ğ¼Ğ¸ÑÑĞ¸Ğ¸">ğŸ“</span>
{% endif %}
{% endwith %}
</td>
 <td class="field-actions">
 <a href="{% url 'admin:directory_position_change' item.object.pk %}" class="edit-link">âœï¸</a>
 <a href="{% url 'admin:directory_position_delete' item.object.pk %}" class="delete-link">ğŸ—‘ï¸</a>
 <a href="{% url 'admin:directory_position_history' item.object.pk %}" class="history-link">ğŸ“‹</a>
 </td>
 </tr>
 {% endfor %}

{# ĞÑ‚Ğ´ĞµĞ»Ñ‹ #}
 {% for dept, dept_data in sub_data.departments.items %}
<tr class="tree-row" data-level="2" data-parent-id="sub_{{ sub.id }}" data-node-id="dept_{{ dept.id }}">
 <td class="field-checkbox"></td>
 <td class="field-name">
 <button type="button" class="toggle-btn" data-state="expanded">[-]</button>
 <span class="tree-icon">{{ tree_settings.icons.department|default:"ğŸ“‚" }}</span>
 {{ dept_data.name }}
</td>
 <td class="field-roles"></td>
 <td class="field-actions"></td>
 </tr>

 {% for item in dept_data.items %}
<tr class="tree-row" data-level="3" data-parent-id="dept_{{ dept.id }}">
 <td class="field-checkbox">
 <input type="checkbox" name="_selected_action" value="{{ item.object.pk }}" class="action-select">
 </td>
 <td class="field-name">
 <span class="tree-icon">{{ item.additional_data.profession_icon|default:"ğŸ‘”" }}</span>
 <a href="{% url 'admin:directory_position_change' item.object.pk %}">
 {{ item.name }}
</a>
 </td>
 <td class="field-roles">
 {% if item.additional_data.total_siz_norms > 0 %}
<span class="badge badge-success" title="Ğ˜Ğ¼ĞµÑÑ‚ÑÑ Ğ½Ğ¾Ñ€Ğ¼Ñ‹ Ğ¡Ğ˜Ğ—">ğŸ›¡ï¸ {{ item.additional_data.total_siz_norms }}</span>
 {% endif %}

{% if item.additional_data.medical_factors_count > 0 %}
<span class="badge badge-info" title="Ğ˜Ğ¼ĞµÑÑ‚ÑÑ Ñ„Ğ°ĞºÑ‚Ğ¾Ñ€Ñ‹ Ğ¼ĞµĞ´Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ¾Ğ²">ğŸ¥ {{ item.additional_data.medical_factors_count }}</span>
 {% endif %}

{% if item.additional_data.is_responsible_for_safety %}
<span class="position-attribute" title="ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ·Ğ° ĞĞ¢">ğŸ”°</span>
 {% endif %}

{% if item.additional_data.can_be_internship_leader %}
<span class="position-attribute" title="ĞœĞ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ñ€ÑƒĞºĞ¾Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ĞµĞ¼ ÑÑ‚Ğ°Ğ¶Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¸">ğŸ‘¨â€ğŸ«</span>
 {% endif %}

{% if item.additional_data.is_electrical_personnel %}
<span class="position-attribute" title="Ğ­Ğ»ĞµĞºÑ‚Ñ€Ğ¾Ñ‚ĞµÑ…Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ»">âš¡</span>
 {% endif %}

{# ĞœĞ¾Ğ¶ĞµÑ‚ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°Ñ‚ÑŒ Ñ€Ğ°ÑĞ¿Ğ¾Ñ€ÑĞ¶ĞµĞ½Ğ¸Ñ #}
{% if item.additional_data.can_sign_orders %}
<span class="position-attribute" title="ĞœĞ¾Ğ¶ĞµÑ‚ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°Ñ‚ÑŒ Ñ€Ğ°ÑĞ¿Ğ¾Ñ€ÑĞ¶ĞµĞ½Ğ¸Ñ">ğŸ“</span>
{% endif %}

{# Ğ“Ñ€ÑƒĞ¿Ğ¿Ğ° Ğ¿Ğ¾ ÑĞ»ĞµĞºÑ‚Ñ€Ğ¾Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸ #}
{% with g=item.additional_data.electrical_group %}
{% if g %}
<span class="position-attribute" title="Ğ“Ñ€ÑƒĞ¿Ğ¿Ğ° {{ g }} Ğ¿Ğ¾ Ğ­Ğ‘">
    {% if g == "I" %}1ï¸âƒ£{% elif g == "II" %}2ï¸âƒ£
    {% elif g == "III" %}3ï¸âƒ£{% elif g == "IV" %}4ï¸âƒ£
    {% elif g == "V" %}5ï¸âƒ£{% endif %}
</span>
{% endif %}
{% endwith %}

{# Ğ Ğ¾Ğ»ÑŒ Ğ² ĞºĞ¾Ğ¼Ğ¸ÑÑĞ¸Ğ¸ #}
{% with r=item.additional_data.commission_role %}
{% if r == "chair" %}
<span class="position-attribute" title="ĞŸÑ€ĞµĞ´ÑĞµĞ´Ğ°Ñ‚ĞµĞ»ÑŒ ĞºĞ¾Ğ¼Ğ¸ÑÑĞ¸Ğ¸">ğŸ—³ï¸</span>
{% elif r == "member" %}
<span class="position-attribute" title="Ğ§Ğ»ĞµĞ½ ĞºĞ¾Ğ¼Ğ¸ÑÑĞ¸Ğ¸">ğŸ‘¥</span>
{% elif r == "secretary" %}
<span class="position-attribute" title="Ğ¡ĞµĞºÑ€ĞµÑ‚Ğ°Ñ€ÑŒ ĞºĞ¾Ğ¼Ğ¸ÑÑĞ¸Ğ¸">ğŸ“</span>
{% endif %}
{% endwith %}
</td>
 <td class="field-actions">
 <a href="{% url 'admin:directory_position_change' item.object.pk %}" class="edit-link">âœï¸</a>
 <a href="{% url 'admin:directory_position_delete' item.object.pk %}" class="delete-link">ğŸ—‘ï¸</a>
 <a href="{% url 'admin:directory_position_history' item.object.pk %}" class="history-link">ğŸ“‹</a>
 </td>
 </tr>
 {% endfor %}
{% endfor %}
{% endfor %}
{% endfor %}
</tbody>
 </table>
 </div>
 </form>
</div>
{% endblock %}

{% block extrahead %}
{{ block.super }}
<link rel="stylesheet" href="{% static 'admin/css/tree_view.css' %}">
 <script src="{% static 'admin/js/tree_view.js' %}"></script>
 <script src="{% static 'admin/js/tree_search.js' %}"></script>
 <style>
 /* Ğ¡Ñ‚Ğ¸Ğ»Ğ¸ Ğ´Ğ»Ñ Ğ±ĞµĞ¹Ğ´Ğ¶ĞµĞ¹ Ğ¸ Ğ¸ĞºĞ¾Ğ½Ğ¾Ğº */
 .badge {
display: inline-block;
padding: 3px 7px;
font-size: 12px;
font-weight: 600;
line-height: 1;
border-radius: 10px;
margin-right: 5px;
}

.badge-success { background-color: #28a745; color: white; }
.badge-info { background-color: #17a2b8; color: white; }

.position-attribute {
display: inline-block;
margin-right: 5px;
font-size: 16px;
}

/* Ğ£Ğ²ĞµĞ»Ğ¸Ñ‡Ğ¸Ğ²Ğ°ĞµĞ¼ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€ Ğ¸ĞºĞ¾Ğ½Ğ¾Ğº Ğ¿Ñ€Ğ¾Ñ„ĞµÑÑĞ¸Ğ¹ */
 .tree-icon {
display: inline-block;
margin-right: 8px;
font-size: 18px;
}
</style>
{% endblock %}