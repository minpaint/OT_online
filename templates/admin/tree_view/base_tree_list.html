{% extends "admin/change_list.html" %}
{% load i18n static %}

{% block extrastyle %}
{{ block.super }}
<link rel="stylesheet" type="text/css" href="{% static 'admin/css/tree_view.css' %}">
{% endblock %}

{% block result_list %}
<div class="module filtered" id="changelist">
    {# üéØ –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–µ—Ä–µ–≤–æ–º #}
    <div class="tree-controls">
        {% if tree_settings.permissions.can_expand %}
        <button type="button" class="tree-btn expand-all" title="{% trans '–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –≤—Å–µ —É–∑–ª—ã' %}">
            <span class="tree-btn-icon">‚Üì</span> {% trans "–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –≤—Å–µ" %}
        </button>
        <button type="button" class="tree-btn collapse-all" title="{% trans '–°–≤–µ—Ä–Ω—É—Ç—å –≤—Å–µ —É–∑–ª—ã' %}">
            <span class="tree-btn-icon">‚Üë</span> {% trans "–°–≤–µ—Ä–Ω—É—Ç—å –≤—Å–µ" %}
        </button>
        {% endif %}

        {% if tree_settings.permissions.can_search %}
        <div class="tree-search-container">
            <input type="text"
                   class="tree-search"
                   placeholder="{% trans 'üîç –ü–æ–∏—Å–∫...' %}"
                   data-search-fields="{{ tree_settings.search_fields|default:'name' }}"
            >
        </div>
        {% endif %}
    </div>

    {# üìã –¢–∞–±–ª–∏—Ü–∞ —Å –¥–µ—Ä–µ–≤–æ–º #}
    <div class="results">
        <table id="result_list">
            <thead>
                <tr>
                    {# –û—Å–Ω–æ–≤–Ω–æ–µ –ø–æ–ª–µ —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º #}
                    <th scope="col" class="column-primary">
                        <div class="text">{% trans "–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ" %}</div>
                    </th>

                    {# –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏ –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫ #}
                    {% for column in tree_settings.columns|default:[] %}
                    <th scope="col" class="column-{{ column.name }}">
                        <div class="text">{{ column.title }}</div>
                    </th>
                    {% endfor %}

                    {# –ö–æ–ª–æ–Ω–∫–∞ —Å –¥–µ–π—Å—Ç–≤–∏—è–º–∏ #}
                    <th scope="col" class="column-actions">
                        <div class="text">{% trans "–î–µ–π—Å—Ç–≤–∏—è" %}</div>
                    </th>
                </tr>
            </thead>
            <tbody>
                {# üå≥ –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ–µ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –¥–µ—Ä–µ–≤–∞ #}
                {% include "admin/tree_components/tree_node.html" with nodes=tree.root level=0 %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block extrahead %}
{{ block.super }}
{# üì¶ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ JavaScript #}
<script src="{% static 'admin/js/tree_core.js' %}"></script>
<script src="{% static 'admin/js/tree_plugins/search.js' %}"></script>

{# ‚öôÔ∏è –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–µ—Ä–µ–≤–∞ #}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // –ü–µ—Ä–µ–¥–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ –±—ç–∫–µ–Ω–¥–∞
    window.treeSettings = {{ tree_settings|safe }};

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –¥–µ—Ä–µ–≤–æ
    const tree = new TreeCore({
        selector: '#result_list',
        settings: window.treeSettings
    });

    // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –ø–ª–∞–≥–∏–Ω—ã
    {% if tree_settings.permissions.can_search %}
    tree.registerPlugin('search', TreeSearchPlugin);
    {% endif %}
});
</script>
{% endblock %}