{% extends 'base.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block title %}{{ title }}{% endblock %}

{% block extra_css %}
<style>
  /* –°—Ç–∏–ª–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ñ–æ—Ä–º—ã */
  .card-header h5 {
    font-weight: 600;
    margin-bottom: 0;
  }
  
  .form-section {
    margin-bottom: 25px;
  }
  
  .form-section h6 {
    border-bottom: 1px solid #e0e0e0;
    padding-bottom: 8px;
    margin-bottom: 15px;
    font-weight: 600;
    color: #505050;
  }
  
  .info-box {
    padding: 15px;
    border-radius: 5px;
    margin-top: 15px;
    margin-bottom: 15px;
  }
  
  .info-box-success {
    background-color: #d4edda;
    border: 1px solid #c3e6cb;
    color: #155724;
  }
  
  .info-box-info {
    background-color: #d1ecf1;
    border: 1px solid #bee5eb;
    color: #0c5460;
  }
  
  .info-box-warning {
    background-color: #fff3cd;
    border: 1px solid #ffeeba;
    color: #856404;
  }
  
  .info-badge {
    display: inline-block;
    padding: 3px 8px;
    border-radius: 3px;
    font-size: 0.75rem;
    font-weight: 600;
    margin-right: 5px;
    margin-bottom: 5px;
  }
  
  .badge-medical {
    background-color: #d1ecf1;
    color: #0c5460;
  }
  
  .badge-siz {
    background-color: #d4edda;
    color: #155724;
  }
  
  .steps-indicator {
    display: flex;
    padding: 0;
    margin: 0 0 20px 0;
    list-style: none;
  }
  
  .steps-indicator li {
    flex: 1;
    position: relative;
    text-align: center;
    padding-top: 25px;
  }
  
  .steps-indicator li::before {
    content: '';
    position: absolute;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background-color: #dee2e6;
    z-index: 1;
  }
  
  .steps-indicator li::after {
    content: '';
    position: absolute;
    top: 10px;
    left: 0;
    width: 100%;
    height: 2px;
    background-color: #dee2e6;
    z-index: 0;
  }
  
  .steps-indicator li:first-child::after {
    left: 50%;
    width: 50%;
  }
  
  .steps-indicator li:last-child::after {
    width: 50%;
  }
  
  .steps-indicator li.active::before {
    background-color: #007bff;
  }
  
  .steps-indicator li.completed::before {
    background-color: #28a745;
  }
  
  .steps-indicator li.active ~ li::after,
  .steps-indicator li::after {
    background-color: #dee2e6;
  }
  
  .steps-indicator li.completed::after {
    background-color: #28a745;
  }
</style>
{% endblock %}

{% block content %}
<div class="container">
  <h1 class="mb-4">{{ title }}</h1>
  
  <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –æ—Å–Ω–æ–≤–Ω—ã—Ö —à–∞–≥–æ–≤ -->
  <div class="row mb-4">
    <div class="col-12">
      <ul class="steps-indicator">
        <li class="active">
          <div>–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</div>
        </li>
        <li>
          <div>–î–æ–∫—É–º–µ–Ω—Ç—ã</div>
        </li>
        <li>
          <div>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</div>
        </li>
      </ul>
    </div>
  </div>
  
  <div class="card">
    <div class="card-header bg-primary text-white">
      <h5>üìù –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –Ω–æ–≤–æ–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–µ</h5>
    </div>
    <div class="card-body">
      {% crispy form %}
    </div>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –º–µ–¥–æ—Å–º–æ—Ç—Ä–µ -->
<div class="modal fade" id="medicalInfoModal" tabindex="-1" role="dialog" aria-labelledby="medicalInfoModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="medicalInfoModalLabel">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–µ–¥–æ—Å–º–æ—Ç—Ä–µ</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col-md-12">
            <h6>–ü–µ—Ä–µ—á–µ–Ω—å –≤—Ä–µ–¥–Ω—ã—Ö —Ñ–∞–∫—Ç–æ—Ä–æ–≤ –¥–ª—è –¥–æ–ª–∂–Ω–æ—Å—Ç–∏ <span id="position-name-medical"></span>:</h6>
            <div id="medical-factors-list">
              <!-- –ó–¥–µ—Å—å –±—É–¥–µ—Ç –≤—ã–≤–æ–¥–∏—Ç—å—Å—è —Å–ø–∏—Å–æ–∫ –≤—Ä–µ–¥–Ω—ã—Ö —Ñ–∞–∫—Ç–æ—Ä–æ–≤ -->
            </div>
            
            <h6 class="mt-3">–¢—Ä–µ–±—É–µ–º–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</h6>
            <ul>
              <li>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞ –º–µ–¥–æ—Å–º–æ—Ç—Ä</li>
              <li>–ú–µ—Å—Ç–æ –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞ –º–µ–¥–æ—Å–º–æ—Ç—Ä</li>
            </ul>
            
            <div class="alert alert-info">
              <i class="fas fa-info-circle"></i> –ü–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –≤–∞–º –±—É–¥–µ—Ç –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–æ —Ä–∞—Å–ø–µ—á–∞—Ç–∞—Ç—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –º–µ–¥–æ—Å–º–æ—Ç—Ä.
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">–ó–∞–∫—Ä—ã—Ç—å</button>
        <button type="button" class="btn btn-primary" id="addMedicalInfoBtn">–î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é</button>
      </div>
    </div>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –°–ò–ó -->
<div class="modal fade" id="sizInfoModal" tabindex="-1" role="dialog" aria-labelledby="sizInfoModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="sizInfoModalLabel">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –°–ò–ó</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col-md-12">
            <h6>–ü–µ—Ä–µ—á–µ–Ω—å –°–ò–ó –¥–ª—è –¥–æ–ª–∂–Ω–æ—Å—Ç–∏ <span id="position-name-siz"></span>:</h6>
            <div id="siz-list">
              <!-- –ó–¥–µ—Å—å –±—É–¥–µ—Ç –≤—ã–≤–æ–¥–∏—Ç—å—Å—è —Å–ø–∏—Å–æ–∫ –°–ò–ó -->
            </div>
            
            <h6 class="mt-3">–¢—Ä–µ–±—É–µ–º–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</h6>
            <ul>
              <li>–†–æ—Å—Ç - –¥–ª—è –ø–æ–¥–±–æ—Ä–∞ —Å–ø–µ—Ü–æ–¥–µ–∂–¥—ã</li>
              <li>–†–∞–∑–º–µ—Ä –æ–¥–µ–∂–¥—ã - –¥–ª—è –ø–æ–¥–±–æ—Ä–∞ —Å–ø–µ—Ü–æ–¥–µ–∂–¥—ã</li>
              <li>–†–∞–∑–º–µ—Ä –æ–±—É–≤–∏ - –¥–ª—è –ø–æ–¥–±–æ—Ä–∞ —Å–ø–µ—Ü–æ–±—É–≤–∏</li>
            </ul>
            
            <div class="alert alert-info">
              <i class="fas fa-info-circle"></i> –ü–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –≤–∞–º –±—É–¥–µ—Ç –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–æ —Ä–∞—Å–ø–µ—á–∞—Ç–∞—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É —É—á–µ—Ç–∞ –≤—ã–¥–∞—á–∏ –°–ò–ó.
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">–ó–∞–∫—Ä—ã—Ç—å</button>
        <button type="button" class="btn btn-primary" id="addSizInfoBtn">–î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é</button>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function() {
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Select2 –¥–ª—è –≤—Å–µ—Ö —Å–µ–ª–µ–∫—Ç–æ–≤
  $('.select2').select2({
    theme: 'bootstrap4',
    width: '100%'
  });

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ –¥–æ–ª–∂–Ω–æ—Å—Ç–∏
  $('#id_position').on('change', function() {
    var positionId = $(this).val();
    
    // –°–∫—Ä—ã–≤–∞–µ–º –±–ª–æ–∫ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∏ —Å–µ–∫—Ü–∏–∏ —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
    $('#medical-section').addClass('d-none');
    $('#siz-section').addClass('d-none');
    
    if (positionId) {
      // –ó–∞–ø—Ä–æ—Å –∫ API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è—Ö –¥–æ–ª–∂–Ω–æ—Å—Ç–∏
      $.ajax({
        url: '/directory/hiring/api/position/' + positionId + '/requirements/',
        type: 'GET',
        dataType: 'json',
        success: function(data) {
          var positionName = data.position_name;
          
          // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è—Ö (–º–µ–¥–æ—Å–º–æ—Ç—Ä, –°–ò–ó)
          if (data.needs_medical) {
            $('#position-name-medical').text(positionName);
            $('#medical-section').removeClass('d-none');
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–∞–∫—Ç–æ—Ä—ã –¥–ª—è –º–µ–¥–æ—Å–º–æ—Ç—Ä–∞
            $.getJSON('/directory/api/medical/position/' + positionId + '/norms/', function(medData) {
              $('#medical-factors-list').empty();
              if (medData.factors && medData.factors.length > 0) {
                var factorsHtml = '<ul>';
                $.each(medData.factors, function(index, factor) {
                  factorsHtml += '<li><strong>' + factor.short_name + '</strong> - ' + factor.full_name + '</li>';
                });
                factorsHtml += '</ul>';
                $('#medical-factors-list').html(factorsHtml);
              } else {
                $('#medical-factors-list').html('<p>–ù–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –≤—Ä–µ–¥–Ω—ã—Ö —Ñ–∞–∫—Ç–æ—Ä–∞—Ö.</p>');
              }
            });
          }
          
          if (data.needs_siz) {
            $('#position-name-siz').text(positionName);
            $('#siz-section').removeClass('d-none');
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –°–ò–ó –¥–ª—è –¥–æ–ª–∂–Ω–æ—Å—Ç–∏
            $.getJSON('/directory/api/positions/' + positionId + '/siz-norms/', function(sizData) {
              $('#siz-list').empty();
              if (sizData.base_norms && sizData.base_norms.length > 0) {
                var sizHtml = '<ul>';
                $.each(sizData.base_norms, function(index, norm) {
                  sizHtml += '<li><strong>' + norm.siz_name + '</strong> - ' + norm.classification + 
                            ' (–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: ' + norm.quantity + ' ' + norm.unit + ')</li>';
                });
                sizHtml += '</ul>';
                $('#siz-list').html(sizHtml);
              } else {
                $('#siz-list').html('<p>–ù–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –°–ò–ó.</p>');
              }
            });
          }
        },
        error: function(xhr, status, error) {
          console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –¥–æ–ª–∂–Ω–æ—Å—Ç–∏:', error);
        }
      });
    }
  });
  
  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é" –¥–ª—è –º–µ–¥–æ—Å–º–æ—Ç—Ä–∞
  $('#addMedicalInfoBtn').on('click', function() {
    $('#medicalInfoModal').modal('hide');
    $('#medical-section').removeClass('d-none');
    $('html, body').animate({
      scrollTop: $('#medical-section').offset().top - 100
    }, 500);
  });
  
  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é" –¥–ª—è –°–ò–ó
  $('#addSizInfoBtn').on('click', function() {
    $('#sizInfoModal').modal('hide');
    $('#siz-section').removeClass('d-none');
    $('html, body').animate({
      scrollTop: $('#siz-section').offset().top - 100
    }, 500);
  });
  
  // –ü–æ–∫–∞–∑ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –º–µ–¥–æ—Å–º–æ—Ç—Ä–µ
  $(document).on('click', '.show-medical-info', function(e) {
    e.preventDefault();
    $('#medicalInfoModal').modal('show');
  });
  
  // –ü–æ–∫–∞–∑ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –°–ò–ó
  $(document).on('click', '.show-siz-info', function(e) {
    e.preventDefault();
    $('#sizInfoModal').modal('show');
  });
  
  // –ó–∞–ø—É—Å–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã, –µ—Å–ª–∏ –¥–æ–ª–∂–Ω–æ—Å—Ç—å —É–∂–µ –≤—ã–±—Ä–∞–Ω–∞
  if ($('#id_position').val()) {
    $('#id_position').trigger('change');
  }
});
</script>
{% endblock %}