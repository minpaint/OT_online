{% extends 'base.html' %}

{% block title %}–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–Ω–∞–Ω–∏–π - OT Online{% endblock %}

{% block content %}
<div class="container">
    <h1 class="mb-4">üìù –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–Ω–∞–Ω–∏–π –ø–æ –æ—Ö—Ä–∞–Ω–µ —Ç—Ä—É–¥–∞</h1>

    <div class="row">
        <div class="col-md-8">
            <!-- –û–±—É—á–∞—é—â–∏–µ —ç–∫–∑–∞–º–µ–Ω—ã –ø–æ —Ä–∞–∑–¥–µ–ª–∞–º -->
            <h2 class="h4 mb-3">üìö –û–±—É—á–µ–Ω–∏–µ –ø–æ —Ç–µ–º–∞–º</h2>

            {% if categories %}
                <div class="accordion" id="categoriesAccordion">
                    {% for category in categories %}
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="heading{{ category.id }}">
                            <button class="accordion-button collapsed" type="button"
                                    data-bs-toggle="collapse"
                                    data-bs-target="#collapse{{ category.id }}"
                                    aria-expanded="false"
                                    aria-controls="collapse{{ category.id }}">
                                {{ category.name }}
                                <span class="badge bg-secondary ms-2">{{ category.get_questions_count }} –≤–æ–ø—Ä–æ—Å–æ–≤</span>
                            </button>
                        </h2>
                        <div id="collapse{{ category.id }}"
                             class="accordion-collapse collapse"
                             aria-labelledby="heading{{ category.id }}"
                             data-bs-parent="#categoriesAccordion">
                            <div class="accordion-body">
                                <p class="text-muted">{{ category.description|default:"" }}</p>

                                <div class="d-flex flex-wrap gap-2 mb-3">
                                    {% if category.get_questions_count and category.quiz_for_training %}
                                    <a href="{% url 'directory:quiz:quiz_start_category' quiz_id=category.quiz_for_training.id category_id=category.id %}"
                                       class="btn btn-primary btn-sm">
                                        <i class="fas fa-dumbbell me-1"></i> –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –ø–æ —Ä–∞–∑–¥–µ–ª—É
                                    </a>
                                    {% else %}
                                    <button class="btn btn-primary btn-sm" disabled>
                                        <i class="fas fa-dumbbell me-1"></i> –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞
                                    </button>
                                    {% endif %}
                                    <a href="{% url 'directory:quiz:category_detail' category_id=category.id %}"
                                       class="btn btn-outline-primary btn-sm">
                                        –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–∞–∑–¥–µ–ª
                                    </a>
                                </div>

                                {# –£–±—Ä–∞–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω—ã—Ö –∫–≤–∏–∑–æ–≤ - —Ç–µ–ø–µ—Ä—å —Ç–æ–ª—å–∫–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –ø–æ —Ä–∞–∑–¥–µ–ª—É #}

                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i> –ü–æ–∫–∞ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π –¥–ª—è –æ–±—É—á–µ–Ω–∏—è.
                </div>
            {% endif %}

            <!-- –≠–∫–∑–∞–º–µ–Ω—ã -->
            <h2 class="h4 mb-3 mt-5">üéì –î–æ—Å—Ç—É–ø–Ω—ã–µ —ç–∫–∑–∞–º–µ–Ω—ã</h2>

            {% if quizzes %}
                <div class="row">
                    {% for quiz in quizzes %}
                    <div class="col-md-6 mb-3">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">{{ quiz.title }}</h5>
                                <p class="card-text">{{ quiz.description|truncatewords:15 }}</p>
                                <ul class="list-unstyled small text-muted">
                                    <li>üìù –í–æ–ø—Ä–æ—Å–æ–≤: {{ quiz.exam_total_questions }}</li>
                                    <li>‚è± –í—Ä–µ–º—è: {{ quiz.exam_time_limit }} –º–∏–Ω</li>
                                    <li>‚ö† –î–æ–ø—É—Å—Ç–∏–º—ã–µ –æ—à–∏–±–∫–∏: {% if quiz.exam_allowed_incorrect %}{{ quiz.exam_allowed_incorrect }}{% else %}–±–µ–∑ –ª–∏–º–∏—Ç–∞{% endif %}</li>
                                    <li>üîÄ {{ quiz.random_order|yesno:"–°–ª—É—á–∞–π–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –≤–æ–ø—Ä–æ—Å–æ–≤,–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫" }}</li>
                                </ul>
                                <a href="{% url 'directory:quiz:quiz_start' quiz_id=quiz.id %}"
                                   class="btn btn-success">–ù–∞—á–∞—Ç—å —ç–∫–∑–∞–º–µ–Ω</a>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i> –ü–æ–∫–∞ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —ç–∫–∑–∞–º–µ–Ω–æ–≤.
                </div>
            {% endif %}
        </div>

        <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å —Å–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π -->
        <div class="col-md-4">
            <div class="card mb-3">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">üìä –í–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h5>
                </div>
                <div class="card-body">
                    <p class="mb-2"><strong>–ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫:</strong> {{ user_attempts.count }}</p>
                    <a href="{% url 'directory:quiz:quiz_history' %}" class="btn btn-outline-primary btn-sm w-100">
                        –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è
                    </a>
                </div>
            </div>

            <!-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
            {% if user_attempts %}
            <div class="card">
                <div class="card-header">
                    <h6 class="mb-0">–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</h6>
                </div>
                <div class="list-group list-group-flush">
                    {% for attempt in user_attempts|slice:":5" %}
                    <a href="{% url 'directory:quiz:quiz_result' attempt_id=attempt.id %}"
                       class="list-group-item list-group-item-action">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 class="mb-1">{{ attempt.quiz.title|truncatewords:5 }}</h6>
                            <small>{{ attempt.completed_at|date:"d.m.Y" }}</small>
                        </div>
                        <p class="mb-1">
                            <span class="badge {% if attempt.passed %}bg-success{% else %}bg-danger{% endif %}">
                                {{ attempt.score_percentage }}%
                            </span>
                        </p>
                    </a>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
