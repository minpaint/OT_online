{% extends 'admin/base_site.html' %}
{% load static %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<div class="container-fluid" style="max-width: 1200px; margin: 20px auto;">
    <h1>üîç {{ title }}</h1>

    <div class="card mb-4">
        <div class="card-header {% if images_only %}bg-info{% else %}bg-success{% endif %} text-white">
            <h5 class="mb-0">üìä {% if images_only %}üñºÔ∏è –ü—Ä–∏–≤—è–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π{% else %}–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–º–ø–æ—Ä—Ç–∞{% endif %}</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <p><strong>–†–∞–∑–¥–µ–ª:</strong> {{ category.name }}</p>

                    {% if images_only %}
                        <!-- –†–µ–∂–∏–º —Ç–æ–ª—å–∫–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π -->
                        <p><strong>–†–µ–∂–∏–º:</strong> <span class="badge bg-info">–ü—Ä–∏–≤—è–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –≤–æ–ø—Ä–æ—Å–∞–º</span></p>
                        <p><strong>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ –∞—Ä—Ö–∏–≤–µ:</strong> {{ images_count }}</p>
                        <p><strong>–¢–µ–∫—É—â–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –≤ —Ä–∞–∑–¥–µ–ª–µ:</strong> {{ existing_questions_count }}</p>

                        <div class="alert alert-info mt-3">
                            <strong>‚ÑπÔ∏è –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:</strong>
                            <ul class="mb-0 mt-2">
                                <li>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ <code>1.jpg</code> ‚Üí –í–æ–ø—Ä–æ—Å ‚Ññ1</li>
                                <li>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ <code>2.jpg</code> ‚Üí –í–æ–ø—Ä–æ—Å ‚Ññ2</li>
                                <li>–ò —Ç–∞–∫ –¥–∞–ª–µ–µ...</li>
                            </ul>
                            <p class="mb-0 mt-2">–ï—Å–ª–∏ —É –≤–æ–ø—Ä–æ—Å–∞ —É–∂–µ –µ—Å—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, –æ–Ω–æ –±—É–¥–µ—Ç –∑–∞–º–µ–Ω–µ–Ω–æ.</p>
                        </div>
                    {% else %}
                        <!-- –†–µ–∂–∏–º –∏–º–ø–æ—Ä—Ç–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ -->
                        <p><strong>–í—Å–µ–≥–æ –≤–æ–ø—Ä–æ—Å–æ–≤ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞:</strong> {{ total_questions }}</p>
                        <p><strong>–° –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –æ—Ç–≤–µ—Ç–∞–º–∏:</strong> {{ questions_with_correct }} ({{ questions_with_correct|floatformat:0 }}/{{ total_questions }})</p>
                        {% if images_count %}
                        <p><strong>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –Ω–∞–π–¥–µ–Ω–æ:</strong> {{ images_count }}</p>
                        {% endif %}
                    {% endif %}
                </div>
                <div class="col-md-6">
                    {% if not images_only %}
                        <p><strong>–¢–µ–∫—É—â–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –≤ —Ä–∞–∑–¥–µ–ª–µ:</strong> {{ existing_questions_count }}</p>
                        {% if replace_existing %}
                        <p class="text-danger"><strong>‚ö†Ô∏è –î–µ–π—Å—Ç–≤–∏–µ:</strong> –ó–∞–º–µ–Ω–∏—Ç—å –≤—Å–µ (—É–¥–∞–ª–∏—Ç—å {{ existing_questions_count }}, –¥–æ–±–∞–≤–∏—Ç—å {{ total_questions }})</p>
                        {% else %}
                        <p class="text-success"><strong>–î–µ–π—Å—Ç–≤–∏–µ:</strong> –î–æ–±–∞–≤–∏—Ç—å –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º</p>
                        {% endif %}
                        <p><strong>–ò—Ç–æ–≥–æ –≤–æ–ø—Ä–æ—Å–æ–≤ –≤ —Ä–∞–∑–¥–µ–ª–µ:</strong> <span class="badge bg-primary">{{ final_count }}</span></p>
                    {% else %}
                        <div class="alert alert-success">
                            <strong>‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏–º–ø–æ—Ä—Ç—É</strong>
                            <p class="mb-0 mt-2">–ë—É–¥–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ –¥–æ {{ existing_questions_count }} –≤–æ–ø—Ä–æ—Å–æ–≤</p>
                        </div>
                    {% endif %}
                </div>
            </div>

            {% if not images_only %}
                {% if questions_with_errors > 0 %}
                <div class="alert alert-danger mt-3">
                    <strong>‚ùå –ù–∞–π–¥–µ–Ω–æ –ø—Ä–æ–±–ª–µ–º: {{ questions_with_errors }}</strong>
                    <ul class="mt-2 mb-0">
                        {% for error in validation_errors %}
                        <li>{{ error }}</li>
                        {% endfor %}
                        {% if validation_errors|length > 10 %}
                        <li><em>... –∏ –µ—â–µ {{ questions_with_errors|add:"-10" }} –æ—à–∏–±–æ–∫</em></li>
                        {% endif %}
                    </ul>
                    <p class="mt-2 mb-0"><strong>‚ö†Ô∏è –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø—Ä–∞–≤–∏—Ç—å –æ—à–∏–±–∫–∏ –≤ —Ñ–∞–π–ª–µ –ø–µ—Ä–µ–¥ –∏–º–ø–æ—Ä—Ç–æ–º!</strong></p>
                </div>
                {% else %}
                <div class="alert alert-success mt-3">
                    <strong>‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ–π–¥–µ–Ω–∞!</strong> –í—Å–µ –≤–æ–ø—Ä–æ—Å—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã.
                </div>
                {% endif %}
            {% endif %}
        </div>
    </div>

    {% if not images_only %}
    <div class="card mb-4">
        <div class="card-header bg-info text-white">
            <h5 class="mb-0">üìã –ü—Ä–∏–º–µ—Ä—ã –≤–æ–ø—Ä–æ—Å–æ–≤ (–ø–µ—Ä–≤—ã–µ 5)</h5>
        </div>
        <div class="card-body">
            {% for question in questions %}
            <div class="card mb-3 {% if forloop.counter0 < questions_with_errors %}border-danger{% endif %}">
                <div class="card-header">
                    <strong>–í–æ–ø—Ä–æ—Å ‚Ññ{{ forloop.counter }}</strong>
                </div>
                <div class="card-body">
                    <p><strong>–¢–µ–∫—Å—Ç:</strong> {{ question.text }}</p>

                    <p><strong>–í–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–∞:</strong></p>
                    <ul class="list-unstyled">
                        {% for answer in question.answers %}
                        <li class="{% if answer.is_correct %}text-success fw-bold{% endif %}">
                            {% if answer.is_correct %}‚úì{% else %}‚óã{% endif %}
                            {{ answer.text }}
                            {% if answer.is_correct %}
                            <span class="badge bg-success">–ü–†–ê–í–ò–õ–¨–ù–´–ô</span>
                            {% endif %}
                        </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
            {% endfor %}

            {% if total_questions > 5 %}
            <p class="text-muted text-center">
                <em>... –∏ –µ—â–µ {{ total_questions|add:"-5" }} –≤–æ–ø—Ä–æ—Å–æ–≤</em>
            </p>
            {% endif %}
        </div>
    </div>
    {% endif %}

    <div class="card">
        <div class="card-body">
            <form method="post">
                {% csrf_token %}

                <div class="d-flex gap-2 justify-content-between">
                    <a href="{% url 'directory:quiz:quiz_import_cancel' %}" class="btn btn-danger">
                        ‚ùå –û—Ç–º–µ–Ω–∏—Ç—å –∏–º–ø–æ—Ä—Ç
                    </a>

                    {% if images_only %}
                        <button type="submit" class="btn btn-success btn-lg">
                            üñºÔ∏è –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –ø—Ä–∏–≤—è–∑–∫—É {{ images_count }} –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
                        </button>
                    {% elif questions_with_errors == 0 %}
                        <button type="submit" class="btn btn-success btn-lg">
                            ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∏–º–ø–æ—Ä—Ç {{ total_questions }} –≤–æ–ø—Ä–æ—Å–æ–≤
                        </button>
                    {% else %}
                        <button type="submit" class="btn btn-warning btn-lg" onclick="return confirm('–û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –æ—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∏–º–ø–æ—Ä—Ç?')">
                            ‚ö†Ô∏è –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ –æ—à–∏–±–∫–∏
                        </button>
                    {% endif %}
                </div>
            </form>
        </div>
    </div>
</div>

<style>
    .card {
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
</style>
{% endblock %}
