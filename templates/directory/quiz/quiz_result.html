{% extends "base_exam.html" %}

{% block title %}–†–µ–∑—É–ª—å—Ç–∞—Ç ‚Äî {{ quiz.title }}{% endblock %}

{% block extra_css %}
<style>
    .sticky-results {
        position: sticky;
        top: 10px;
        max-height: calc(100vh - 20px);
        overflow-y: auto;
    }

    /* –ö–æ–º–ø–∞–∫—Ç–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –∫–∞—Ä—Ç–æ—á–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ */
    .results-card .card-header {
        padding: 0.5rem 0.75rem;
    }

    .results-card .card-body {
        padding: 0.75rem;
    }

    .results-card .list-unstyled li {
        margin-bottom: 0.35rem;
        font-size: 0.85rem;
    }

    .results-card .text-muted.small {
        font-size: 0.75rem;
    }

    .results-card .btn {
        padding: 0.4rem 0.75rem;
        font-size: 0.85rem;
    }

    .results-card .alert {
        padding: 0.4rem 0.6rem;
        margin-bottom: 0 !important;
        font-size: 0.8rem;
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –±–ª–æ–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤ */
    .answers-block .list-group-item {
        padding: 1rem;
        margin-bottom: 0.5rem;
        border-radius: 6px;
    }

    .answers-block .list-group-item h6 {
        font-size: 0.9rem;
        font-weight: 600;
        color: #495057;
    }

    /* –¢–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞ - –∫—Ä—É–ø–Ω—ã–π –∏ –∂–∏—Ä–Ω—ã–π */
    .answers-block .question-text {
        font-size: 1.1rem;
        font-weight: 700;
        color: #212529;
        line-height: 1.4;
        margin-bottom: 0.75rem;
    }

    .answers-block .small {
        font-size: 0.95rem;
    }

    .answers-block .badge {
        font-size: 0.85rem;
        padding: 0.3rem 0.6rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid px-3 py-2">
<div class="row">
    <div class="col-lg-2">
        <div class="card shadow-sm mb-4 results-card sticky-results">
            {% if attempt.is_exam_mode %}
                {# –ò—Ç–æ–≥–æ–≤—ã–π —ç–∫–∑–∞–º–µ–Ω - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º passed/failed #}
                {% if attempt.passed %}
                    <div class="card-header bg-success text-white">
                        <h6 class="mb-0 text-center" style="font-weight: 700;">‚úÖ –≠–ö–ó–ê–ú–ï–ù –ü–†–û–ô–î–ï–ù</h6>
                    </div>
                    <div class="card-body">
                        <p class="mb-2">
                            <span class="badge bg-success">–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!</span>
                        </p>
                {% else %}
                    {# –ü–†–û–í–ê–õ –≠–ö–ó–ê–ú–ï–ù–ê - –ö–†–ê–°–ù–´–ô –≠–ö–†–ê–ù #}
                    <div class="card-header bg-danger text-white">
                        <h5 class="mb-0 text-center" style="font-weight: 700;">‚ùå –≠–ö–ó–ê–ú–ï–ù –ù–ï –°–î–ê–ù</h5>
                    </div>
                    <div class="card-body" style="border: 2px solid #dc3545;">
                        <div class="alert alert-danger mb-2 py-2" style="font-size: 0.95rem;">
                            <strong>–í—ã –Ω–µ –ø—Ä–æ—à–ª–∏ —ç–∫–∑–∞–º–µ–Ω</strong>
                        </div>
                        {% if attempt.failure_reason %}
                            <p class="text-muted mb-2" style="font-size: 0.9rem;">
                                <strong>–ü—Ä–∏—á–∏–Ω–∞:</strong> {{ attempt.get_failure_reason_display }}
                            </p>
                        {% endif %}
                {% endif %}
            {% else %}
                {# –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ - –±–µ–∑ –æ—Ü–µ–Ω–∫–∏ passed/failed #}
                <div class="card-header bg-primary text-white">
                    <h6 class="mb-0 text-center" style="font-weight: 700;">üìö –¢–†–ï–ù–ò–†–û–í–ö–ê</h6>
                </div>
                <div class="card-body">
                    <p class="text-muted mb-2" style="font-size: 0.85rem;">
                        –ù–∏–∂–µ –ø–æ–∫–∞–∑–∞–Ω—ã —Ç–æ–ª—å–∫–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –¥–ª—è —Ä–∞–∑–±–æ—Ä–∞.
                    </p>
            {% endif %}
                <ul class="list-unstyled mb-2">
                    <li><strong>–í—Å–µ–≥–æ –≤–æ–ø—Ä–æ—Å–æ–≤:</strong> {{ attempt.total_questions }}</li>
                    <li><strong>–ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö:</strong> {{ attempt.correct_answers }}</li>
                    <li><strong>–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö:</strong> {{ attempt.incorrect_answers }}</li>
                    <li><strong>–ü—Ä–æ–ø—É—â–µ–Ω–æ:</strong> {{ attempt.skipped_questions }}</li>
                </ul>
                <p class="text-muted small mb-0">
                    <i class="fas fa-clock"></i> {{ attempt.started_at|date:"d.m.Y H:i" }}
                </p>
                {% if attempt.completed_at %}
                <p class="text-muted small mb-2">
                    <i class="fas fa-check"></i> {{ attempt.completed_at|date:"d.m.Y H:i" }}
                </p>
                {% endif %}
                <div class="d-grid gap-2">
                    {% if not request.session.quiz_token_mode %}
                        <a href="{% url 'directory:quiz:quiz_list' %}" class="btn btn-primary">–ö —ç–∫–∑–∞–º–µ–Ω–∞–º</a>
                        <a href="{% url 'directory:quiz:quiz_history' %}" class="btn btn-outline-secondary">–ò—Å—Ç–æ—Ä–∏—è –ø–æ–ø—ã—Ç–æ–∫</a>
                    {% else %}
                        <a href="{% url 'directory:quiz:exam_home' %}" class="btn btn-outline-primary">
                            <i class="fas fa-home"></i> –ù–∞ –≥–ª–∞–≤–Ω—É—é
                        </a>
                        {% if attempt.category %}
                            {# –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –ø–æ —Ä–∞–∑–¥–µ–ª—É - –Ω–∞—á–∞—Ç—å —Å–Ω–æ–≤–∞ —Ç–æ—Ç –∂–µ —Ä–∞–∑–¥–µ–ª #}
                            <a href="{% url 'directory:quiz:quiz_start_category' quiz_id=quiz.id category_id=attempt.category.id %}" class="btn btn-success">
                                <i class="fas fa-redo"></i> –ü—Ä–æ–π—Ç–∏ —Å–Ω–æ–≤–∞
                            </a>
                        {% else %}
                            {# –ò—Ç–æ–≥–æ–≤—ã–π —ç–∫–∑–∞–º–µ–Ω - –Ω–∞—á–∞—Ç—å —Å–Ω–æ–≤–∞ –≤–µ—Å—å —ç–∫–∑–∞–º–µ–Ω #}
                            <a href="{% url 'directory:quiz:quiz_start' quiz_id=quiz.id %}" class="btn btn-success">
                                <i class="fas fa-redo"></i> –ü—Ä–æ–π—Ç–∏ —ç–∫–∑–∞–º–µ–Ω —Å–Ω–æ–≤–∞
                            </a>
                        {% endif %}
                        <div class="alert alert-info mt-2 mb-0" style="font-size: 0.9rem;">
                            <i class="fas fa-info-circle"></i> –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    <div class="col-lg-10">
        <div class="card shadow-sm">
            <div class="card-header bg-light">
                <h4 class="mb-0" style="font-weight: 600;">
                    {% if attempt.is_exam_mode %}
                        üìã –í—Å–µ –æ—Ç–≤–µ—Ç—ã
                    {% else %}
                        ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –¥–ª—è —Ä–∞–∑–±–æ—Ä–∞
                    {% endif %}
                </h4>
            </div>
            <div class="card-body answers-block">
                {% if user_answers %}
                    {% if attempt.is_exam_mode %}
                        {# –≠–∫–∑–∞–º–µ–Ω: –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ –æ—Ç–≤–µ—Ç—ã #}
                        <div class="list-group">
                            {% for entry in user_answers %}
                                <div class="list-group-item list-group-item-action">
                                    <div class="d-flex justify-content-between">
                                        <h6 class="mb-1">–í–æ–ø—Ä–æ—Å {{ forloop.counter }}</h6>
                                        {% if entry.is_correct %}
                                            <span class="badge bg-success">–í–µ—Ä–Ω–æ</span>
                                        {% elif entry.is_skipped %}
                                            <span class="badge bg-warning text-dark">–ü—Ä–æ–ø—É—â–µ–Ω</span>
                                        {% else %}
                                            <span class="badge bg-danger">–ù–µ–≤–µ—Ä–Ω–æ</span>
                                        {% endif %}
                                    </div>
                                    <p class="question-text">{{ entry.question.question_text }}</p>
                                    {% if entry.selected_answer %}
                                        {% if entry.is_correct %}
                                            <p class="small mb-0 text-success"><strong>‚úÖ –í–∞—à –æ—Ç–≤–µ—Ç:</strong> {{ entry.selected_answer.answer_text }}</p>
                                        {% else %}
                                            <p class="small mb-0 text-danger"><strong>‚ùå –í–∞—à –æ—Ç–≤–µ—Ç:</strong> {{ entry.selected_answer.answer_text }}</p>
                                        {% endif %}
                                    {% elif entry.is_skipped %}
                                        <p class="small mb-0 text-warning"><strong>‚ö†Ô∏è –û—Ç–≤–µ—Ç –Ω–µ –≤—ã–±—Ä–∞–Ω</strong></p>
                                    {% endif %}
                                    {% if not entry.is_correct %}
                                        {% with correct=entry.question.get_correct_answer %}
                                            {% if correct %}
                                                <p class="small text-success mb-0"><strong>‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç:</strong> {{ correct.answer_text }}</p>
                                            {% endif %}
                                        {% endwith %}
                                    {% endif %}
                                </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        {# –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞: –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ #}
                        <div class="list-group">
                            {% for entry in user_answers %}
                                {% if not entry.is_correct %}
                                    <div class="list-group-item list-group-item-action">
                                        <div class="d-flex justify-content-between">
                                            <h6 class="mb-1">–í–æ–ø—Ä–æ—Å {{ forloop.counter }}</h6>
                                            {% if entry.is_skipped %}
                                                <span class="badge bg-warning text-dark">–ü—Ä–æ–ø—É—â–µ–Ω</span>
                                            {% else %}
                                                <span class="badge bg-danger">–ù–µ–≤–µ—Ä–Ω–æ</span>
                                            {% endif %}
                                        </div>
                                        <p class="question-text">{{ entry.question.question_text }}</p>
                                        {% if entry.selected_answer %}
                                            <p class="small mb-0 text-danger"><strong>‚ùå –í–∞—à –æ—Ç–≤–µ—Ç:</strong> {{ entry.selected_answer.answer_text }}</p>
                                        {% elif entry.is_skipped %}
                                            <p class="small mb-0 text-warning"><strong>‚ö†Ô∏è –û—Ç–≤–µ—Ç –Ω–µ –≤—ã–±—Ä–∞–Ω</strong></p>
                                        {% endif %}
                                        {% with correct=entry.question.get_correct_answer %}
                                            {% if correct %}
                                                <p class="small text-success mb-0"><strong>‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç:</strong> {{ correct.answer_text }}</p>
                                            {% endif %}
                                        {% endwith %}
                                    </div>
                                {% endif %}
                            {% endfor %}
                        </div>
                        {% if attempt.incorrect_answers == 0 %}
                            <div class="alert alert-success mt-3">
                                <strong>–û—Ç–ª–∏—á–Ω–æ!</strong> –í—ã –æ—Ç–≤–µ—Ç–∏–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞ –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã.
                            </div>
                        {% endif %}
                    {% endif %}
                {% else %}
                    <p class="text-muted mb-0">–û—Ç–≤–µ—Ç–æ–≤ –Ω–µ—Ç.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
</div>
{% endblock %}
