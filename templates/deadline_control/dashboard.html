{% extends "base.html" %}
{% load static %}

{% block title %}‚è∞ –ö–æ–Ω—Ç—Ä–æ–ª—å —Å—Ä–æ–∫–æ–≤ - Dashboard{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <h2>‚è∞ –ö–æ–Ω—Ç—Ä–æ–ª—å —Å—Ä–æ–∫–æ–≤ - Dashboard</h2>

    <!-- –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="row mt-4">
        <div class="col-md">
            <div class="card bg-danger text-white">
                <div class="card-body">
                    <h5 class="card-title">üö® –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ</h5>
                    <h2 class="card-text">{{ total_overdue }}</h2>
                    <small>—Ç—Ä–µ–±—É—é—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –≤–Ω–∏–º–∞–Ω–∏—è</small>
                </div>
            </div>
        </div>
        <div class="col-md">
            <div class="card bg-warning text-dark">
                <div class="card-body">
                    <h5 class="card-title">‚ö†Ô∏è –°–∫–æ—Ä–æ –∏—Å—Ç–µ–∫–∞–µ—Ç</h5>
                    <h2 class="card-text">{{ total_upcoming }}</h2>
                    <small>–≤ —Ç–µ—á–µ–Ω–∏–µ 14 –¥–Ω–µ–π</small>
                </div>
            </div>
        </div>
        <div class="col-md">
            <div class="card bg-info text-white">
                <div class="card-body">
                    <h5 class="card-title">‚öôÔ∏è –û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ</h5>
                    <h2 class="card-text">{{ total_equipment }}</h2>
                    <small>–Ω–∞ –∫–æ–Ω—Ç—Ä–æ–ª–µ</small>
                </div>
            </div>
        </div>
        <div class="col-md">
            <div class="card bg-success text-white">
                <div class="card-body">
                    <h5 class="card-title">üìÖ –ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</h5>
                    <h2 class="card-text">{{ total_deadlines }}</h2>
                    <small>–≤ –≥—Ä–∞—Ñ–∏–∫–µ</small>
                </div>
            </div>
        </div>
        <div class="col-md">
            <div class="card bg-primary text-white">
                <div class="card-body">
                    <h5 class="card-title">üè• –ú–µ–¥–æ—Å–º–æ—Ç—Ä—ã</h5>
                    <h2 class="card-text">{{ total_medical }}</h2>
                    <small>–Ω–∞ –∫–æ–Ω—Ç—Ä–æ–ª–µ</small>
                </div>
            </div>
        </div>
    </div>

    <!-- –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ -->
    {% if overdue_equipment %}
    <div class="row mt-4">
        <div class="col-md-12">
            <div class="card border-danger">
                <div class="card-header bg-danger text-white">
                    <h5 class="mb-0">üö® –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω–æ–µ –¢–û –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è ({{ overdue_equipment_count }})</h5>
                </div>
                <div class="card-body">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ</th>
                                <th>–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è</th>
                                <th>–°–ª–µ–¥—É—é—â–µ–µ –¢–û</th>
                                <th>–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ –¥–Ω–µ–π</th>
                                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for eq in overdue_equipment %}
                            <tr>
                                <td><strong>{{ eq.equipment_name }}</strong></td>
                                <td>{{ eq.organization.short_name_ru }}</td>
                                <td>{{ eq.next_maintenance_date|date:"d.m.Y" }}</td>
                                <td><span class="badge badge-danger">{{ eq.days_until_maintenance|add:"-1"|stringformat:"d"|slice:"1:" }}</span></td>
                                <td>
                                    <a href="{% url 'deadline_control:equipment:detail' eq.pk %}" class="btn btn-sm btn-primary">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- –°–∫–æ—Ä–æ –¢–û –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è -->
    {% if upcoming_equipment %}
    <div class="row mt-4">
        <div class="col-md-12">
            <div class="card border-warning">
                <div class="card-header bg-warning text-dark">
                    <h5 class="mb-0">‚ö†Ô∏è –°–∫–æ—Ä–æ –¢–û –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è ({{ upcoming_equipment_count }})</h5>
                </div>
                <div class="card-body">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ</th>
                                <th>–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è</th>
                                <th>–°–ª–µ–¥—É—é—â–µ–µ –¢–û</th>
                                <th>–û—Å—Ç–∞–ª–æ—Å—å –¥–Ω–µ–π</th>
                                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for eq in upcoming_equipment %}
                            <tr>
                                <td><strong>{{ eq.equipment_name }}</strong></td>
                                <td>{{ eq.organization.short_name_ru }}</td>
                                <td>{{ eq.next_maintenance_date|date:"d.m.Y" }}</td>
                                <td><span class="badge badge-warning">{{ eq.days_until_maintenance }}</span></td>
                                <td>
                                    <a href="{% url 'deadline_control:equipment:detail' eq.pk %}" class="btn btn-sm btn-primary">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è -->
    {% if overdue_deadlines %}
    <div class="row mt-4">
        <div class="col-md-12">
            <div class="card border-danger">
                <div class="card-header bg-danger text-white">
                    <h5 class="mb-0">üö® –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è ({{ overdue_deadlines_count }})</h5>
                </div>
                <div class="card-body">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ</th>
                                <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                                <th>–°–ª–µ–¥—É—é—â–∞—è –¥–∞—Ç–∞</th>
                                <th>–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ –¥–Ω–µ–π</th>
                                <th>–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in overdue_deadlines %}
                            <tr>
                                <td><strong>{{ item.name }}</strong></td>
                                <td>{{ item.category.name }}</td>
                                <td>{{ item.next_date|date:"d.m.Y" }}</td>
                                <td><span class="badge badge-danger">{{ item.days_until_next|add:"-1"|stringformat:"d"|slice:"1:" }}</span></td>
                                <td>{{ item.responsible_person|default:"-" }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- –°–∫–æ—Ä–æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è -->
    {% if upcoming_deadlines %}
    <div class="row mt-4">
        <div class="col-md-12">
            <div class="card border-warning">
                <div class="card-header bg-warning text-dark">
                    <h5 class="mb-0">‚ö†Ô∏è –ü—Ä–µ–¥—Å—Ç–æ—è—â–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è ({{ upcoming_deadlines_count }})</h5>
                </div>
                <div class="card-body">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ</th>
                                <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                                <th>–°–ª–µ–¥—É—é—â–∞—è –¥–∞—Ç–∞</th>
                                <th>–û—Å—Ç–∞–ª–æ—Å—å –¥–Ω–µ–π</th>
                                <th>–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in upcoming_deadlines %}
                            <tr>
                                <td><strong>{{ item.name }}</strong></td>
                                <td>{{ item.category.name }}</td>
                                <td>{{ item.next_date|date:"d.m.Y" }}</td>
                                <td><span class="badge badge-warning">{{ item.days_until_next }}</span></td>
                                <td>{{ item.responsible_person|default:"-" }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ –º–µ–¥–æ—Å–º–æ—Ç—Ä—ã -->
    {% if overdue_medical %}
    <div class="row mt-4">
        <div class="col-md-12">
            <div class="card border-danger">
                <div class="card-header bg-danger text-white">
                    <h5 class="mb-0">üö® –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ –º–µ–¥–æ—Å–º–æ—Ç—Ä—ã ({{ overdue_medical_count }})</h5>
                </div>
                <div class="card-body">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>–°–æ—Ç—Ä—É–¥–Ω–∏–∫</th>
                                <th>–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è</th>
                                <th>–í—Ä–µ–¥–Ω—ã–π —Ñ–∞–∫—Ç–æ—Ä</th>
                                <th>–°–ª–µ–¥—É—é—â–∏–π –æ—Å–º–æ—Ç—Ä</th>
                                <th>–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ –¥–Ω–µ–π</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for exam in overdue_medical %}
                            <tr>
                                <td><strong>{{ exam.employee.full_name_nominative }}</strong></td>
                                <td>{{ exam.employee.organization.short_name_ru }}</td>
                                <td>{{ exam.harmful_factor.name }}</td>
                                <td>{{ exam.next_date|date:"d.m.Y" }}</td>
                                <td><span class="badge badge-danger">{{ exam.days_until_next|add:"-1"|stringformat:"d"|slice:"1:" }}</span></td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- –ü—Ä–µ–¥—Å—Ç–æ—è—â–∏–µ –º–µ–¥–æ—Å–º–æ—Ç—Ä—ã -->
    {% if upcoming_medical %}
    <div class="row mt-4">
        <div class="col-md-12">
            <div class="card border-warning">
                <div class="card-header bg-warning text-dark">
                    <h5 class="mb-0">‚ö†Ô∏è –ü—Ä–µ–¥—Å—Ç–æ—è—â–∏–µ –º–µ–¥–æ—Å–º–æ—Ç—Ä—ã ({{ upcoming_medical_count }})</h5>
                </div>
                <div class="card-body">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>–°–æ—Ç—Ä—É–¥–Ω–∏–∫</th>
                                <th>–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è</th>
                                <th>–í—Ä–µ–¥–Ω—ã–π —Ñ–∞–∫—Ç–æ—Ä</th>
                                <th>–°–ª–µ–¥—É—é—â–∏–π –æ—Å–º–æ—Ç—Ä</th>
                                <th>–û—Å—Ç–∞–ª–æ—Å—å –¥–Ω–µ–π</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for exam in upcoming_medical %}
                            <tr>
                                <td><strong>{{ exam.employee.full_name_nominative }}</strong></td>
                                <td>{{ exam.employee.organization.short_name_ru }}</td>
                                <td>{{ exam.harmful_factor.name }}</td>
                                <td>{{ exam.next_date|date:"d.m.Y" }}</td>
                                <td><span class="badge badge-warning">{{ exam.days_until_next }}</span></td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- –ï—Å–ª–∏ –≤—Å—ë –≤ –ø–æ—Ä—è–¥–∫–µ -->
    {% if not total_overdue and not total_upcoming %}
    <div class="row mt-4">
        <div class="col-md-12">
            <div class="alert alert-success text-center">
                <h4>‚úÖ –í—Å–µ —Å—Ä–æ–∫–∏ –ø–æ–¥ –∫–æ–Ω—Ç—Ä–æ–ª–µ–º!</h4>
                <p>–ù–µ—Ç –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö –∏–ª–∏ –∏—Å—Ç–µ–∫–∞—é—â–∏—Ö –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π.</p>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
    <div class="row mt-4 mb-4">
        <div class="col-md-12">
            <h5>–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h5>
            <a href="{% url 'deadline_control:equipment:list' %}" class="btn btn-primary mr-2">‚öôÔ∏è –°–ø–∏—Å–æ–∫ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è</a>
            <a href="{% url 'deadline_control:key_deadline:list' %}" class="btn btn-success mr-2">üìÖ –ö–ª—é—á–µ–≤—ã–µ —Å—Ä–æ–∫–∏</a>
            <a href="{% url 'deadline_control:medical:list' %}" class="btn btn-secondary mr-2">üè• –ú–µ–¥–æ—Å–º–æ—Ç—Ä—ã</a>
            <a href="{% url 'deadline_control:equipment:create' %}" class="btn btn-info mr-2">‚ûï –î–æ–±–∞–≤–∏—Ç—å –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ</a>
            <a href="{% url 'deadline_control:key_deadline:item_create' %}" class="btn btn-warning">‚ûï –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ</a>
        </div>
    </div>
</div>
{% endblock %}
