{% extends 'base.html' %}
{% load crispy_forms_tags %}
{% load static %}

{% block title %}{{ title }}{% endblock %}

{% block extra_css %}
<!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Select2 -->
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet">
<!-- –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–º—É Bootstrap 4 –¥–ª—è Select2 -->
<link href="https://cdn.jsdelivr.net/npm/@ttskch/select2-bootstrap4-theme@1.5.2/dist/select2-bootstrap4.min.css" rel="stylesheet">
<style>
    /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è Select2 */
    .select2-container {
        width: 100% !important;
        display: block;
    }
    
    /* –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ —Å—Ç—Ä–µ–ª–∫–∏ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞ */
    .select2-container--default .select2-selection--single .select2-selection__arrow,
    .select2-container--bootstrap4 .select2-selection--single .select2-selection__arrow {
        top: 50% !important;
        right: 3px !important;
        transform: translateY(-50%) !important;
        width: 20px !important;
        height: 20px !important;
        position: absolute !important;
    }
    
    /* –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –∏ –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–∞ */
    .select2-container--default .select2-selection--single .select2-selection__rendered,
    .select2-container--bootstrap4 .select2-selection--single .select2-selection__rendered {
        color: #495057 !important;
        line-height: calc(1.5em + 0.1rem) !important;
        padding-left: 0 !important;
        padding-right: 20px !important;
        text-align: left !important;
        overflow: hidden !important;
        text-overflow: ellipsis !important;
        white-space: nowrap !important;
        vertical-align: middle !important;
    }
    
    /* –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –≤—ã—Å–æ—Ç—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –æ—Ç—Å—Ç—É–ø–æ–≤ */
    .select2-container--default .select2-selection--single,
    .select2-container--bootstrap4 .select2-selection--single {
        height: calc(1.5em + 0.75rem + 2px) !important;
        padding: 0.375rem 0.75rem !important;
        border: 1px solid #ced4da !important;
        border-radius: 0.25rem !important;
        text-align: left !important;
    }
    
    /* –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–∫–æ–Ω–æ–∫ –¥–ª—è –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–∞ */
    .select2-container--default .select2-selection__placeholder,
    .select2-container--bootstrap4 .select2-selection__placeholder {
        color: #6c757d !important;
        display: inline-block !important;
        width: 100% !important;
        overflow: hidden !important;
        text-overflow: ellipsis !important;
    }
    
    /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞ */
    .select2-container--open .select2-dropdown {
        font-size: 1rem;
        border-color: #80bdff;
        outline: 0;
        box-shadow: 0 0 0 0.2rem rgba(0,123,255,.25);
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å–ø–∏—Å–∫–∞ */
    .select2-container--default .select2-results__option,
    .select2-container--bootstrap4 .select2-results__option {
        padding: 0.375rem 0.75rem;
    }
    
    /* –°—Ç–∏–ª—å –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ */
    .select2-container--default .select2-results__option--highlighted[aria-selected],
    .select2-container--bootstrap4 .select2-results__option--highlighted[aria-selected] {
        background-color: #007bff;
        color: white;
    }
</style>
{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h3>üìù –ü—Ä–∏–µ–º –Ω–∞ —Ä–∞–±–æ—Ç—É</h3>
                </div>
                <div class="card-body">
                    <form method="post" id="hiring-form">
                        {% csrf_token %}
                        {{ form.media }}
                        {{ form|crispy }}
                        <div class="row mt-3">
                            <div class="col-6">
                                <button type="submit" name="preview" value="true" class="btn btn-info w-100">
                                    üëÅ –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
                                </button>
                            </div>
                            <div class="col-6">
                                <button type="submit" class="btn btn-success w-100">
                                    üíæ –ü—Ä–∏–Ω—è—Ç—å –Ω–∞ —Ä–∞–±–æ—Ç—É
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- –ë–ª–æ–∫ "–ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø—Ä–∏–Ω—è—Ç—ã–µ" -->
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    <h4>üìä –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø—Ä–∏–Ω—è—Ç—ã–µ</h4>
                </div>
                <div class="card-body">
                    {% if recent_employees %}
                        <ul class="list-group">
                        {% for employee in recent_employees %}
                            <li class="list-group-item">
                                <strong>{{ employee.full_name_nominative }}</strong><br>
                                <small>{{ employee.position }} ({{ employee.organization.short_name_ru }})</small>
                            </li>
                        {% endfor %}
                        </ul>
                    {% else %}
                        <p class="text-muted">–ù–µ—Ç –Ω–µ–¥–∞–≤–Ω–æ –ø—Ä–∏–Ω—è—Ç—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function() {
    // –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Select2
    $('.select2').select2({
        theme: 'bootstrap4',
        width: '100%',
        dropdownAutoWidth: true,
        allowClear: false,
        escapeMarkup: function(markup) {
            return markup; // –†–∞–∑—Ä–µ—à–∞–µ–º HTML –≤ –æ–ø—Ü–∏—è—Ö (–¥–ª—è —ç–º–æ–¥–∑–∏)
        },
        templateResult: function(data) {
            // –†–∞–∑—Ä–µ—à–∞–µ–º HTML –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö –ø–æ–∏—Å–∫–∞
            return data.text;
        },
        templateSelection: function(data) {
            // –†–∞–∑—Ä–µ—à–∞–µ–º HTML –≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–º —ç–ª–µ–º–µ–Ω—Ç–µ
            return data.text;
        }
    });
    
    // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
    setTimeout(function() {
        $('.select2').trigger('select2:update');
    }, 100);
    
    // –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
    console.log('–ù–∞–π–¥–µ–Ω–æ –ø–æ–ª–µ–π select2:', $('.select2').length);
});
</script>
{% endblock %}