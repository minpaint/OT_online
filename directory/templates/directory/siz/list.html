{% extends 'base.html' %}
{% load static %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<div class="container">
    <div class="row mb-4">
        <div class="col">
            <h1>üõ°Ô∏è –°—Ä–µ–¥—Å—Ç–≤–∞ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–π –∑–∞—â–∏—Ç—ã</h1>
            <p class="lead">–£—á–µ—Ç –∏ –≤—ã–¥–∞—á–∞ –°–ò–ó —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º</p>
        </div>
        <div class="col-auto d-flex align-items-center">
            {% if user.is_staff %}
            <a href="{% url 'admin:directory_siz_add' %}" class="btn btn-success me-2">
                <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –°–ò–ó
            </a>
            {% endif %}
            <a href="{% url 'directory:siz:siz_issue' %}" class="btn btn-primary">
                <i class="fas fa-hand-holding"></i> –í—ã–¥–∞—Ç—å –°–ò–ó
            </a>
        </div>
    </div>

    <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ —Å –æ—Å–Ω–æ–≤–Ω—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏ -->
    <div class="row mb-4">
        <div class="col-md-4 mb-3">
            <div class="card h-100">
                <div class="card-body">
                    <h5 class="card-title">üìã –í—ã–¥–∞—á–∞ –°–ò–ó</h5>
                    <p class="card-text">–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –≤—ã–¥–∞—á–∏ –°–ò–ó —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º —Å —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ–º –ª–∏—á–Ω–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏ —É—á–µ—Ç–∞.</p>
                    <a href="{% url 'directory:siz:siz_issue' %}" class="btn btn-outline-primary">–ü–µ—Ä–µ–π—Ç–∏</a>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="card h-100">
                <div class="card-body">
                    <h5 class="card-title">üë§ –õ–∏—á–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏</h5>
                    <p class="card-text">–ü—Ä–æ—Å–º–æ—Ç—Ä –ª–∏—á–Ω—ã—Ö –∫–∞—Ä—Ç–æ—á–µ–∫ —É—á–µ—Ç–∞ –≤—ã–¥–∞—á–∏ –°–ò–ó —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º.</p>
                    <a href="#" class="btn btn-outline-primary" onclick="showEmployeeSelector()">–í—ã–±—Ä–∞—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</a>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="card h-100">
                <div class="card-body">
                    <h5 class="card-title">üîÑ –í–æ–∑–≤—Ä–∞—Ç –°–ò–ó</h5>
                    <p class="card-text">–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –≤–æ–∑–≤—Ä–∞—Ç–∞ —Ä–∞–Ω–µ–µ –≤—ã–¥–∞–Ω–Ω—ã—Ö –°–ò–ó –æ—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤.</p>
                    <a href="#" class="btn btn-outline-primary" onclick="showEmployeeSelector()">–í—ã–±—Ä–∞—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</a>
                </div>
            </div>
        </div>
    </div>

    <!-- –°–ø–∏—Å–æ–∫ –Ω–µ–¥–∞–≤–Ω–æ –≤—ã–¥–∞–Ω–Ω—ã—Ö –°–ò–ó -->
    <div class="card mb-4">
        <div class="card-header">
            <h5>üìä –ù–µ–¥–∞–≤–Ω–æ –≤—ã–¥–∞–Ω–Ω—ã–µ –°–ò–ó</h5>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th>–î–∞—Ç–∞ –≤—ã–¥–∞—á–∏</th>
                            <th>–°–æ—Ç—Ä—É–¥–Ω–∏–∫</th>
                            <th>–°–ò–ó</th>
                            <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                            <th>–°—Ç–∞—Ç—É—Å</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in recent_issued %}
                        <tr>
                            <td>{{ item.issue_date|date:"d.m.Y" }}</td>
                            <td>{{ item.employee }}</td>
                            <td>{{ item.siz }}</td>
                            <td>{{ item.quantity }}</td>
                            <td>
                                {% if item.is_returned %}
                                <span class="badge bg-secondary">–í–æ–∑–≤—Ä–∞—â–µ–Ω–æ</span>
                                {% else %}
                                <span class="badge bg-success">–ê–∫—Ç–∏–≤–Ω–æ</span>
                                {% endif %}
                            </td>
                            <td>
                                <a href="{% url 'directory:siz:siz_personal_card' item.employee.id %}" class="btn btn-sm btn-outline-info">
                                    <i class="fas fa-id-card"></i>
                                </a>
                                {% if not item.is_returned %}
                                <a href="{% url 'directory:siz:siz_return' item.id %}" class="btn btn-sm btn-outline-warning">
                                    <i class="fas fa-undo"></i>
                                </a>
                                {% endif %}
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="6" class="text-center">–ù–µ—Ç –Ω–µ–¥–∞–≤–Ω–æ –≤—ã–¥–∞–Ω–Ω—ã—Ö –°–ò–ó</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ -->
<div class="modal fade" id="employeeSelectModal" tabindex="-1" aria-labelledby="employeeSelectModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="employeeSelectModalLabel">–í—ã–±–æ—Ä —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="employeeSelectForm">
                    <div class="mb-3">
                        <label for="employeeSelect" class="form-label">–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</label>
                        <select class="form-select" id="employeeSelect" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞...</option>
                            {% for employee in employees %}
                            <option value="{{ employee.id }}">{{ employee.full_name_nominative }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                <button type="button" class="btn btn-primary" id="goToEmployeeCardBtn">–ü–µ—Ä–µ–π—Ç–∏</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –≤—ã–±–æ—Ä–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
function showEmployeeSelector() {
    const modal = new bootstrap.Modal(document.getElementById('employeeSelectModal'));
    modal.show();
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ –∫–∞—Ä—Ç–æ—á–∫–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
document.getElementById('goToEmployeeCardBtn').addEventListener('click', function() {
    const employeeId = document.getElementById('employeeSelect').value;
    if (employeeId) {
        window.location.href = "{% url 'directory:siz:siz_personal_card' 0 %}".replace('0', employeeId);
    }
});
</script>
{% endblock %}