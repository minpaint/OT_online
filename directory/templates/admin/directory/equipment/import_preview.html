{% extends "admin/base_site.html" %}
{% load static %}

{% block title %}{{ title }}{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
    <a href="{% url 'admin:index' %}">–ì–ª–∞–≤–Ω–∞—è</a>
    &rsaquo; <a href="{% url 'admin:app_list' app_label='directory' %}">Directory</a>
    &rsaquo; <a href="{% url 'admin:directory_equipment_changelist' %}">–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ</a>
    &rsaquo; {{ title }}
</div>
{% endblock %}

{% block content %}
<div class="module">
    <h1>üìã –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∏–º–ø–æ—Ä—Ç–∞ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è</h1>

    {% if result.has_errors %}
    <div class="messagelist">
        <div class="error">
            <h3>‚ùå –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –æ—à–∏–±–∫–∏ ({{ result.totals.error }})</h3>
            <ul>
                {% for row in result.invalid_rows %}
                <li>
                    <strong>–°—Ç—Ä–æ–∫–∞ {{ row.number }}:</strong>
                    {{ row.error_dict|default:"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞" }}
                </li>
                {% endfor %}
            </ul>
        </div>
    </div>
    {% endif %}

    <div class="help" style="background-color: #d1ecf1; padding: 15px; border-left: 4px solid #0c5460; margin: 20px 0;">
        <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–º–ø–æ—Ä—Ç–∞</h3>
        <ul>
            <li>‚úÖ –ù–æ–≤–æ–≥–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è: <strong>{{ result.totals.new }}</strong></li>
            <li>üîÑ –ë—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–æ: <strong>{{ result.totals.update }}</strong></li>
            <li>‚è≠Ô∏è –ü—Ä–æ–ø—É—â–µ–Ω–æ: <strong>{{ result.totals.skip }}</strong></li>
            <li>‚ùå –û—à–∏–±–æ–∫: <strong>{{ result.totals.error }}</strong></li>
        </ul>
    </div>

    <fieldset class="module aligned">
        <h2>–î–∞–Ω–Ω—ã–µ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞:</h2>
        <div style="overflow-x: auto;">
            <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
                <thead>
                    <tr style="background-color: #417690; color: white;">
                        <th style="border: 1px solid #ddd; padding: 8px;">#</th>
                        <th style="border: 1px solid #ddd; padding: 8px;">–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è</th>
                        <th style="border: 1px solid #ddd; padding: 8px;">–ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ</th>
                        <th style="border: 1px solid #ddd; padding: 8px;">–û—Ç–¥–µ–ª</th>
                        <th style="border: 1px solid #ddd; padding: 8px;">–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ</th>
                        <th style="border: 1px solid #ddd; padding: 8px;">–ò–Ω–≤. –Ω–æ–º–µ—Ä</th>
                        <th style="border: 1px solid #ddd; padding: 8px;">–ü–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å –¢–û</th>
                        <th style="border: 1px solid #ddd; padding: 8px;">–ü–æ—Å–ª–µ–¥–Ω–µ–µ –¢–û</th>
                        <th style="border: 1px solid #ddd; padding: 8px;">–°—Ç–∞—Ç—É—Å</th>
                    </tr>
                </thead>
                <tbody>
                    {% for row in dataset %}
                    <tr {% if forloop.counter|divisibleby:2 %}style="background-color: #f9f9f9;"{% endif %}>
                        <td style="border: 1px solid #ddd; padding: 8px;">{{ forloop.counter }}</td>
                        <td style="border: 1px solid #ddd; padding: 8px;">{{ row.org_short_name_ru|default:"-" }}</td>
                        <td style="border: 1px solid #ddd; padding: 8px;">{{ row.subdivision_name|default:"-" }}</td>
                        <td style="border: 1px solid #ddd; padding: 8px;">{{ row.department_name|default:"-" }}</td>
                        <td style="border: 1px solid #ddd; padding: 8px;">{{ row.equipment_name|default:"-" }}</td>
                        <td style="border: 1px solid #ddd; padding: 8px;">{{ row.inventory_number|default:"–∞–≤—Ç–æ–≥–µ–Ω." }}</td>
                        <td style="border: 1px solid #ddd; padding: 8px;">{{ row.maintenance_period_months|default:"-" }} –º–µ—Å.</td>
                        <td style="border: 1px solid #ddd; padding: 8px;">{{ row.last_maintenance_date|default:"-" }}</td>
                        <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">
                            {% if row in result.invalid_rows %}
                            <span style="background-color: #dc3545; color: white; padding: 3px 8px; border-radius: 3px;">–û—à–∏–±–∫–∞</span>
                            {% else %}
                            <span style="background-color: #28a745; color: white; padding: 3px 8px; border-radius: 3px;">OK</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </fieldset>

    <form method="post" enctype="multipart/form-data" style="margin-top: 20px;">
        {% csrf_token %}
        <input type="hidden" name="confirm" value="1">

        <div class="submit-row">
            <input type="submit" value="‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∏–º–ø–æ—Ä—Ç" class="default" {% if result.has_errors %}disabled{% endif %}>
            <a href="{% url 'admin:directory_equipment_import' %}" class="button">–û—Ç–º–µ–Ω–∞</a>
        </div>

        {% if result.has_errors %}
        <div class="help" style="background-color: #fff3cd; padding: 15px; border-left: 4px solid #ffc107; margin-top: 20px;">
            ‚ö†Ô∏è –ò–º–ø–æ—Ä—Ç –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω –∏–∑-–∑–∞ –æ—à–∏–±–æ–∫. –ò—Å–ø—Ä–∞–≤—å—Ç–µ —Ñ–∞–π–ª –∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –∑–∞–Ω–æ–≤–æ.
        </div>
        {% endif %}
    </form>
</div>
{% endblock %}
